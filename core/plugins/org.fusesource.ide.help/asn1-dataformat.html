<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>ASN.1 File DataFormat</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="apns-component.html" title="APNS Component"><link rel="next" href="asterisk-component.html" title="Asterisk Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="asn1-dataformat"></a>ASN.1 File DataFormat</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="asn1-dataformat.html#_asn_1_data_format_options">ASN.1 Data Format Options</a></span></dt><dt><span class="section"><a href="asn1-dataformat.html#_unmarshal">Unmarshal</a></span></dt><dt><span class="section"><a href="asn1-dataformat.html#_dependencies">Dependencies</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.20</strong></span></p><p>The ASN.1 Data Format Data Format [Intoduction to ASN.1](<a class="link" href="https://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx" target="_top">https://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx</a>) is a Camel Frameworks&#8217;s data format implementation based on Bouncy Castle&#8217;s bcprov-jdk15on library and jASN.1&#8217;s java compiler for the formal notation used for describing data transmitted by telecommunications protocols, regardless of language implementation and physical representation of these data, whatever the application, whether complex or very simple. Messages can be unmarshalled (conversion to simple Java POJO(s)) to plain Java objects. By the help of Camel&#8217;s routing engine and data transformations you can then play with POJO(s) and apply customised formatting and call other Camel Component&#8217;s to convert and send messages to upstream systems.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_asn_1_data_format_options"></a>ASN.1 Data Format Options</h2></div></div></div><p>The ASN.1 File dataformat supports 3 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="10%" class="col_3"><col width="60%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>usingIterator</strong></span></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>If the asn1 file has more then one entry, the setting this option to true, allows to work with the splitter EIP, to split the data using an iterator in a streaming mode.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>clazzName</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Name of class to use when unmarshalling</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>contentTypeHeader</strong></span></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether the data format should set the Content-Type header with the type from the data format if the data format is capable of doing so. For example application/xml for data formats marshalling to XML, or application/json for data formats marshalling to JSon etc.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_unmarshal"></a>Unmarshal</h2></div></div></div><p>There are 3 different ways to unmarshal ASN.1 structured messages. (Usually binary files)</p><p>In this first example we unmarshal BER file payload to OutputStream and send it to mock endpoint.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:unmarshal"</em></strong>).unmarshal(asn1).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:unmarshal"</em></strong>);</pre><p>In the second example we unmarshal BER file payload to byte array using Split EIP. The reason for applying Split EIP is that usually each BER file or (ASN.1 structured file) contains multiple records to process and Split EIP helps us to get each record in a file as byte arrays which is actually ASN1Primitive&#8217;s instance (by the use of Bouncy Castle&#8217;s ASN.1 support in bcprov-jdk15on library)
Byte arrays then may be converted to ASN1Primitive by the help of public static method in (ASN1Primitive.fromByteArray)
In such example, note that you need to set <code class="literal">usingIterator=true</code></p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:unmarshal"</em></strong>).unmarshal(asn1).split(body(Iterator.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)).streaming().to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:unmarshal"</em></strong>);</pre><p>In the last example we unmarshal BER file payload to plain old Java Objects using Split EIP. The reason for applying Split EIP is already mentioned in the previous example. Please note and keep in mind that reason. In such example we also need to set the fully qualified name of the class or &lt;YourObject&gt;.class reference through data format.
The important thing to note here is that your object should have been generated by jasn1 compiler which is a nice tool to generate java object representations of your ASN.1 structure. For the reference usage of jasn1 compiler see [JASN.1 Project Page](<a class="link" href="https://www.openmuc.org/asn1/" target="_top">https://www.openmuc.org/asn1/</a>) and please also see how the compiler is invoked with the help of maven&#8217;s exec plugin.
For example, in this data format&#8217;s unit tests an example ASN.1 structure(TestSMSBerCdr.asn1) is added in <code class="literal">src/test/resources/asn1_structure</code>. jasn1 compiler is invoked and java object&#8217;s representations are generated in <code class="literal">${basedir}/target/generated/src/test/java</code>
The nice thing about this example, you will get POJO instance at the mock endpoint or at whatever your endpoint is.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:unmarshaldsl"</em></strong>)
         .unmarshal()
         .asn1(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"org.apache.camel.dataformat.asn1.model.testsmscbercdr.SmsCdr"</em></strong>)
         .split(body(Iterator.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)).streaming()
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:unmarshaldsl"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dependencies"></a>Dependencies</h2></div></div></div><p>To use ASN.1 data format in your camel routes you need to add a dependency on
<span class="strong"><strong>camel-asn1</strong></span> which implements this data format.</p><p>If you use Maven you can just add the following to your <code class="literal">pom.xml</code>,
substituting the version number for the latest &amp; greatest release (see
the download page for the latest versions).</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-asn1<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div></div></body></html>