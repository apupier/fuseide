<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>XStream DataFormat</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="xslt-component.html" title="XSLT Component"><link rel="next" href="yaml-snakeyaml-dataformat.html" title="YAML SnakeYAML DataFormat"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="xstream-dataformat"></a>XStream DataFormat</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="xstream-dataformat.html#_options_171">Options</a></span></dt><dt><span class="section"><a href="xstream-dataformat.html#_using_the_java_dsl_8">Using the Java DSL</a></span></dt><dt><span class="section"><a href="xstream-dataformat.html#_xmlinputfactory_and_xmloutputfactory_2">XMLInputFactory and XMLOutputFactory</a></span></dt><dt><span class="section"><a href="xstream-dataformat.html#_how_to_set_the_xml_encoding_in_xstream_dataformat_2">How to set the XML encoding in Xstream DataFormat?</a></span></dt><dt><span class="section"><a href="xstream-dataformat.html#_setting_the_type_permissions_of_xstream_dataformat_2">Setting the type permissions of Xstream DataFormat</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 1.3</strong></span></p><p>XStream is a Data Format which uses the
<a class="link" href="http://xstream.codehaus.org/" target="_top">XStream library</a> to marshal and unmarshal
Java objects to and from XML.</p><p>To use XStream in your camel routes you need to add the a dependency
on&nbsp;<span class="strong"><strong>camel-xstream</strong></span>&nbsp;which implements this data format.</p><p>Maven users will need to add the following dependency to their
<code class="literal">pom.xml</code>&nbsp;for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-xstream<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_171"></a>Options</h2></div></div></div><p>The XStream dataformat supports 10 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="10%" class="col_3"><col width="60%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>permissions</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Adds permissions that controls which Java packages and classes XStream is allowed to use during unmarshal from xml/json to Java beans. A permission must be configured either here or globally using a JVM system property. The permission can be specified in a syntax where a plus sign is allow, and minus sign is deny. Wildcards is supported by using . as prefix. For example to allow com.foo and all subpackages then specfy com.foo.. Multiple permissions can be configured separated by comma, such as com.foo.,-com.foo.bar.MySecretBean. The following default permission is always included: -,java.lang.,java.util. unless its overridden by specifying a JVM system property with they key org.apache.camel.xstream.permissions.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>encoding</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Sets the encoding to use</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>driver</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>To use a custom XStream driver. The instance must be of type com.thoughtworks.xstream.io.HierarchicalStreamDriver</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>driverRef</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>To refer to a custom XStream driver to lookup in the registry. The instance must be of type com.thoughtworks.xstream.io.HierarchicalStreamDriver</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>mode</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Mode for dealing with duplicate references The possible values are: NO_REFERENCES ID_REFERENCES XPATH_RELATIVE_REFERENCES XPATH_ABSOLUTE_REFERENCES SINGLE_NODE_XPATH_RELATIVE_REFERENCES SINGLE_NODE_XPATH_ABSOLUTE_REFERENCES</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>converters</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">List</code></p></td><td align="left" valign="top"><p>List of class names for using custom XStream converters. The classes must be of type com.thoughtworks.xstream.converters.Converter</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>aliases</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>Alias a Class to a shorter name to be used in XML elements.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>omitFields</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>Prevents a field from being serialized. To omit a field you must always provide the declaring type and not necessarily the type that is converted.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>implicitCollections</strong></span></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>Adds a default implicit collection which is used for any unmapped XML tag.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>contentTypeHeader</strong></span></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether the data format should set the Content-Type header with the type from the data format if the data format is capable of doing so. For example application/xml for data formats marshalling to XML, or application/json for data formats marshalling to JSon etc.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_the_java_dsl_8"></a>Using the Java DSL</h2></div></div></div><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// lets turn Object messages into XML then send to MQSeries</em>
from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:My.Queue"</em></strong>).
  marshal().xstream().
  to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mqseries:Another.Queue"</em></strong>);</pre><p>If you would like to configure the <code class="literal">XStream</code> instance used by the Camel
for the message transformation, you can simply pass a reference to that
instance on the DSL level.</p><pre class="programlisting">XStream xStream = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> XStream();
xStream.aliasField(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"money"</em></strong>, PurchaseOrder.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cash"</em></strong>);
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// new Added setModel option since Camel 2.14</em>
xStream.setModel(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"NO_REFERENCES"</em></strong>);
...

from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:marshal"</em></strong>).
  marshal(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> XStreamDataFormat(xStream)).
  to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:marshaled"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_xmlinputfactory_and_xmloutputfactory_2"></a>XMLInputFactory and XMLOutputFactory</h2></div></div></div><p><a class="link" href="http://xstream.codehaus.org/" target="_top">The XStream library</a> uses the
<code class="literal">javax.xml.stream.XMLInputFactory</code> and
<code class="literal">javax.xml.stream.XMLOutputFactory</code>, you can control which
implementation of this factory should be used.</p><p>The Factory is discovered using this algorithm:
 1. Use the <code class="literal">javax.xml.stream.XMLInputFactory</code> ,
<code class="literal">javax.xml.stream.XMLOutputFactory</code> system property.
 2. Use the <code class="literal">lib/xml.stream.properties</code> file in the <code class="literal">JRE_HOME</code>
directory.
 3. Use the Services API, if available, to determine the classname by
looking in the <code class="literal">META-INF/services/javax.xml.stream.XMLInputFactory</code>,
<code class="literal">META-INF/services/javax.xml.stream.XMLOutputFactory</code> files in jars
available to the JRE.
 4. Use the platform default XMLInputFactory,XMLOutputFactory instance.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_how_to_set_the_xml_encoding_in_xstream_dataformat_2"></a>How to set the XML encoding in Xstream DataFormat?</h2></div></div></div><p>From Camel 2.2.0, you can set the encoding of XML in Xstream DataFormat
by setting the Exchange&#8217;s property with the key <code class="literal">Exchange.CHARSET_NAME</code>,
or setting the encoding property on Xstream from DSL or Spring config.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:My.Queue"</em></strong>).
  marshal().xstream(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"UTF-8"</em></strong>).
  to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mqseries:Another.Queue"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_setting_the_type_permissions_of_xstream_dataformat_2"></a>Setting the type permissions of Xstream DataFormat</h2></div></div></div><p>In Camel, one can always use its own processing step in the route to
filter and block certain XML documents to be routed to the XStream&#8217;s
unmarhall step. From Camel 2.16.1, 2.15.5, you can
set&nbsp;<a class="link" href="http://x-stream.github.io/security.html" target="_top">XStream&#8217;s type
permissions</a>&nbsp;to automatically allow or deny the instantiation of certain
types.</p><p>The default type permissions setting used by Camel denies all types
except for those from java.lang and java.util packages. This setting can
be changed by setting System property
org.apache.camel.xstream.permissions. Its value is a string of
comma-separated permission terms, each representing a type being allowed
or denied, depending on whether the term is prefixed with '' (note ''
may be omitted) or with '-', respectively.</p><p>Each term may contain a wildcard character '<span class="strong"><strong>'. For example, value
"-</strong></span>,java.lang.<span class="strong"><strong>,java.util.</strong></span>" indicates denying all types except for
java.lang.* and java.util.* classes. Setting this value to an empty
string "" reverts to the default XStream&#8217;s type permissions handling
which denies certain blacklisted classes and allow others.</p><p>The type permissions setting can be extended at an individual XStream
DataFormat instance by setting its type permissions property.</p><pre class="programlisting">    &lt;dataFormats&gt;
        &lt;xstream id=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"xstream-default"</em></strong>
                 permissions=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"org.apache.camel.samples.xstream.*"</em></strong>/&gt;
        ...</pre></div></div></body></html>