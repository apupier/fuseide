<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>JPA Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="jolt-component.html" title="JOLT Component"><link rel="next" href="scp-component.html" title="SCP Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="jpa-component"></a>JPA Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jpa-component.html#_sending_to_the_endpoint">Sending to the endpoint</a></span></dt><dt><span class="section"><a href="jpa-component.html#_consuming_from_the_endpoint">Consuming from the endpoint</a></span></dt><dt><span class="section"><a href="jpa-component.html#_uri_format_106">URI format</a></span></dt><dt><span class="section"><a href="jpa-component.html#_options_83">Options</a></span></dt><dt><span class="section"><a href="jpa-component.html#_message_headers_27">Message Headers</a></span></dt><dt><span class="section"><a href="jpa-component.html#_configuring_entitymanagerfactory">Configuring EntityManagerFactory</a></span></dt><dt><span class="section"><a href="jpa-component.html#_configuring_transactionmanager">Configuring TransactionManager</a></span></dt><dt><span class="section"><a href="jpa-component.html#_using_a_consumer_with_a_named_query">Using a consumer with a named query</a></span></dt><dt><span class="section"><a href="jpa-component.html#_using_a_consumer_with_a_query">Using a consumer with a query</a></span></dt><dt><span class="section"><a href="jpa-component.html#_using_a_consumer_with_a_native_query">Using a consumer with a native query</a></span></dt><dt><span class="section"><a href="jpa-component.html#_using_a_producer_with_a_named_query">Using a producer with a named query</a></span></dt><dt><span class="section"><a href="jpa-component.html#_using_a_producer_with_a_query">Using a producer with a query</a></span></dt><dt><span class="section"><a href="jpa-component.html#_using_a_producer_with_a_native_query">Using a producer with a native query</a></span></dt><dt><span class="section"><a href="jpa-component.html#_example_11">Example</a></span></dt><dt><span class="section"><a href="jpa-component.html#_using_the_jpa_based_idempotent_repository">Using the JPA-Based Idempotent Repository</a></span></dt><dt><span class="section"><a href="jpa-component.html#_see_also_69">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 1.0</strong></span></p><p>The <span class="strong"><strong>jpa</strong></span> component enables you to store and retrieve Java objects from
persistent storage using EJB 3&#8217;s Java Persistence Architecture (JPA),
which is a standard interface layer that wraps Object/Relational Mapping
(ORM) products such as OpenJPA, Hibernate, TopLink, and so on.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-jpa<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_sending_to_the_endpoint"></a>Sending to the endpoint</h2></div></div></div><p>You can store a Java entity bean in a database by sending it to a JPA
producer endpoint. The body of the <span class="emphasis"><em>In</em></span> message is assumed to be an
entity bean (that is, a POJO with an
<a class="link" href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Entity.html" target="_top">@Entity</a>
annotation on it) or a collection or array of entity beans.</p><p>If the body is a List of entities, make sure to use
<span class="strong"><strong>entityType=java.util.ArrayList</strong></span> as a configuration passed to the
producer endpoint.</p><p>If the body does not contain one of the previous listed types, put a
Message Translator in front of the
endpoint to perform the necessary conversion first.</p><p>From <span class="strong"><strong>Camel 2.19</strong></span> onwards you can use <code class="literal">query</code>, <code class="literal">namedQuery</code> or <code class="literal">nativeQuery</code>
for the producer as well. Also in the value of the <code class="literal">parameters</code>, you can use
Simple expression which allows you to retrieve parameter values from Message body, header
and etc. Those query can be used for retrieving a set of data with using <code class="literal">SELECT</code>
JPQL/SQL statement as well as executing bulk update/delete with using <code class="literal">UPDATE</code>/<code class="literal">DELETE</code>
JPQL/SQL statement. Please note that you need to specify <code class="literal">useExecuteUpdate</code> to <code class="literal">true</code>
if you execute <code class="literal">UPDATE</code>/<code class="literal">DELETE</code> with <code class="literal">namedQuery</code> as camel don&#8217;t look into the
named query unlike <code class="literal">query</code> and <code class="literal">nativeQuery</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_consuming_from_the_endpoint"></a>Consuming from the endpoint</h2></div></div></div><p>Consuming messages from a JPA consumer endpoint removes (or updates)
entity beans in the database. This allows you to use a database table as
a logical queue: consumers take messages from the queue and then
delete/update them to logically remove them from the queue.</p><p>If you do not wish to delete the entity bean when it has been processed
(and when routing is done), you can specify <code class="literal">consumeDelete=false</code> on the
URI. This will result in the entity being processed each poll.</p><p>If you would rather perform some update on the entity to mark it as
processed (such as to exclude it from a future query) then you can
annotate a method with
<a class="link" href="http://camel.apache.org/maven/current/camel-jpa/apidocs/org/apache/camel/component/jpa/Consumed.html" target="_top">@Consumed</a>
which will be invoked on your entity bean when the entity bean when it
has been processed (and when routing is done).</p><p>From <span class="strong"><strong>Camel 2.13</strong></span> onwards you can use
<a class="link" href="http://camel.apache.org/maven/current/camel-jpa/apidocs/org/apache/camel/component/jpa/PreConsumed.html" target="_top">@PreConsumed</a>
which will be invoked on your entity bean before it has been processed
(before routing).</p><p>If you are consuming a lot (100K+) of rows and experience OutOfMemory
problems you should set the maximumResults to sensible value.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_106"></a>URI format</h2></div></div></div><pre class="programlisting">jpa:entityClassName[?options]</pre><p>For sending to the endpoint, the <span class="emphasis"><em>entityClassName</em></span> is optional. If
specified, it helps the <a class="link" href="http://camel.apache.org/type-converter.html" target="_top">Type Converter</a> to
ensure the body is of the correct type.</p><p>For consuming, the <span class="emphasis"><em>entityClassName</em></span> is mandatory.</p><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_83"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jpa-component.html#_path_parameters_1_parameters_100">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="jpa-component.html#_query_parameters_42_parameters">Query Parameters (42 parameters):</a></span></dt></dl></div><p>The JPA component supports 5 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>entityManagerFactory</strong></span> (common)</p></td><td align="left" valign="top"><p>To use the EntityManagerFactory. This is strongly recommended to configure.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>EntityManagerFactory</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>transactionManager</strong></span> (common)</p></td><td align="left" valign="top"><p>To use the PlatformTransactionManager for managing transactions.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>PlatformTransaction Manager</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>joinTransaction</strong></span> (common)</p></td><td align="left" valign="top"><p>The camel-jpa component will join transaction by default. You can use this option to turn this off, for example if you use LOCAL_RESOURCE and join transaction doesn&#8217;t work with your JPA provider. This option can also be set globally on the JpaComponent, instead of having to set it on all endpoints.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sharedEntityManager</strong></span> (common)</p></td><td align="left" valign="top"><p>Whether to use Spring&#8217;s SharedEntityManager for the consumer/producer. Note in most cases joinTransaction should be set to false as this is not an EXTENDED EntityManager.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The JPA endpoint is configured using URI syntax:</p><pre class="screen">jpa:entityType</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_100"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>entityType</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The JPA annotated class to use as entity.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Class&lt;?&gt;</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_42_parameters"></a>Query Parameters (42 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>joinTransaction</strong></span> (common)</p></td><td align="left" valign="top"><p>The camel-jpa component will join transaction by default. You can use this option to turn this off, for example if you use LOCAL_RESOURCE and join transaction doesn&#8217;t work with your JPA provider. This option can also be set globally on the JpaComponent, instead of having to set it on all endpoints.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maximumResults</strong></span> (common)</p></td><td align="left" valign="top"><p>Set the maximum number of results to retrieve on the Query.</p></td><td align="center" valign="top"><p>-1</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>namedQuery</strong></span> (common)</p></td><td align="left" valign="top"><p>To use a named query.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>nativeQuery</strong></span> (common)</p></td><td align="left" valign="top"><p>To use a custom native query. You may want to use the option resultClass also when using native queries.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>parameters</strong></span> (common)</p></td><td align="left" valign="top"><p>This key/value mapping is used for building the query parameters. It is expected to be of the generic type java.util.Map where the keys are the named parameters of a given JPA query and the values are their corresponding effective values you want to select for. When it&#8217;s used for producer, Simple expression can be used as a parameter value. It allows you to retrieve parameter values from the message body, header and etc.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>persistenceUnit</strong></span> (common)</p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The JPA persistence unit used by default.</p></td><td align="center" valign="top"><p>camel</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>query</strong></span> (common)</p></td><td align="left" valign="top"><p>To use a custom query.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resultClass</strong></span> (common)</p></td><td align="left" valign="top"><p>Defines the type of the returned payload (we will call entityManager.createNativeQuery(nativeQuery, resultClass) instead of entityManager.createNativeQuery(nativeQuery)). Without this option, we will return an object array. Only has an affect when using in conjunction with native query when consuming data.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Class&lt;?&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sharedEntityManager</strong></span> (common)</p></td><td align="left" valign="top"><p>Whether to use Spring&#8217;s SharedEntityManager for the consumer/producer. Note in most cases joinTransaction should be set to false as this is not an EXTENDED EntityManager.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>consumeDelete</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If true, the entity is deleted after it is consumed; if false, the entity is not deleted.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>consumeLockEntity</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Specifies whether or not to set an exclusive lock on each entity bean while processing the results from polling.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>deleteHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To use a custom DeleteHandler to delete the row after the consumer is done processing the exchange</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Object&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>lockModeType</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To configure the lock mode on the consumer.</p></td><td align="center" valign="top"><p>PESSIMISTIC_WRITE</p></td><td align="left" valign="top"><p>LockModeType</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maxMessagesPerPoll</strong></span> (consumer)</p></td><td align="left" valign="top"><p>An integer value to define the maximum number of messages to gather per poll. By default, no maximum is set. Can be used to avoid polling many thousands of messages when starting up the server. Set a value of 0 or negative to disable.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>preDeleteHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To use a custom Pre-DeleteHandler to delete the row after the consumer has read the entity.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Object&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sendEmptyMessageWhenIdle</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>skipLockedEntity</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To configure whether to use NOWAIT on lock and silently skip the entity.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>transacted</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Whether to run the consumer in transacted mode, by which all messages will either commit or rollback, when the entire batch has been processed. The default behavior (false) is to commit all the previously successfully processed messages, and only rollback the last failed message.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>pollStrategy</strong></span> (consumer)</p></td><td align="left" valign="top"><p>A pluggable org.apache.camel.PollingConsumerPollingStrategy allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>PollingConsumerPoll Strategy</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>flushOnSend</strong></span> (producer)</p></td><td align="left" valign="top"><p>Flushes the EntityManager after the entity bean has been persisted.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>remove</strong></span> (producer)</p></td><td align="left" valign="top"><p>Indicates to use entityManager.remove(entity).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useExecuteUpdate</strong></span> (producer)</p></td><td align="left" valign="top"><p>To configure whether to use executeUpdate() when producer executes a query. When you use INSERT, UPDATE or DELETE statement as a named query, you need to specify this option to 'true'.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>usePassedInEntityManager</strong></span> (producer)</p></td><td align="left" valign="top"><p>If set to true, then Camel will use the EntityManager from the header JpaConstants.ENTITYMANAGER instead of the configured entity manager on the component/endpoint. This allows end users to control which entity manager will be in use.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>usePersist</strong></span> (producer)</p></td><td align="left" valign="top"><p>Indicates to use entityManager.persist(entity) instead of entityManager.merge(entity). Note: entityManager.persist(entity) doesn&#8217;t work for detached entities (where the EntityManager has to execute an UPDATE instead of an INSERT query)!</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>entityManagerProperties</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Additional properties for the entity manager to use.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffErrorThreshold</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The number of subsequent error polls (failed due some error) that should happen before the backoffMultipler should kick-in.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffIdleThreshold</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The number of subsequent idle polls that should happen before the backoffMultipler should kick-in.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffMultiplier</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To let the scheduled polling consumer backoff if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then backoffIdleThreshold and/or backoffErrorThreshold must also be configured.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>delay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Milliseconds before the next poll. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td><td align="center" valign="top"><p>500</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>greedy</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>If greedy is enabled, then the ScheduledPollConsumer will run immediately again, if the previous run polled 1 or more messages.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>initialDelay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Milliseconds before the first poll starts. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td><td align="center" valign="top"><p>1000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>runLoggingLevel</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td><td align="center" valign="top"><p>TRACE</p></td><td align="left" valign="top"><p>LoggingLevel</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>scheduledExecutorService</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ScheduledExecutor Service</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>scheduler</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To use a cron scheduler from either camel-spring or camel-quartz2 component</p></td><td align="center" valign="top"><p>none</p></td><td align="left" valign="top"><p>ScheduledPollConsumer Scheduler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>schedulerProperties</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To configure additional properties when using a custom scheduler or any of the Quartz2, Spring based scheduler.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>startScheduler</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Whether the scheduler should be auto started.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>timeUnit</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Time unit for initialDelay and delay options.</p></td><td align="center" valign="top"><p>MILLISECONDS</p></td><td align="left" valign="top"><p>TimeUnit</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useFixedDelay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Controls if fixed delay or fixed rate is used. See ScheduledExecutorService in JDK for details.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_headers_27"></a>Message Headers</h2></div></div></div><p>Camel adds the following message headers to the exchange:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelJpaTemplate</code></p></td><td align="left" valign="top"><p><code class="literal">JpaTemplate</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Not supported anymore since Camel 2.12:</strong></span> The <code class="literal">JpaTemplate</code> object that
is used to access the entity bean. You need this object in some
situations, for instance in a type converter or when you are doing some
custom processing. See
<a class="link" href="https://issues.apache.org/jira/browse/CAMEL-5932" target="_top">CAMEL-5932</a> for the
reason why the support for this header has been dropped.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelEntityManager</code></p></td><td align="left" valign="top"><p><code class="literal">EntityManager</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.12: JPA consumer / Camel 2.12.2: JPA producer:</strong></span> The JPA
<code class="literal">EntityManager</code> object being used by <code class="literal">JpaConsumer</code> or <code class="literal">JpaProducer</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuring_entitymanagerfactory"></a>Configuring EntityManagerFactory</h2></div></div></div><p>Its strongly advised to configure the JPA component to use a specific
<code class="literal">EntityManagerFactory</code> instance. If failed to do so each <code class="literal">JpaEndpoint</code>
will auto create their own instance of <code class="literal">EntityManagerFactory</code> which most
often is not what you want.</p><p>For example, you can instantiate a JPA component that references the
<code class="literal">myEMFactory</code> entity manager factory, as follows:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"jpa"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.jpa.JpaComponent"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
   <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"entityManagerFactory"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myEMFactory"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre><p>In <span class="strong"><strong>Camel 2.3</strong></span> the <code class="literal">JpaComponent</code> will auto lookup the
<code class="literal">EntityManagerFactory</code> from the Registry which means
you do not need to configure this on the <code class="literal">JpaComponent</code> as shown above.
You only need to do so if there is ambiguity, in which case Camel will
log a WARN.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuring_transactionmanager"></a>Configuring TransactionManager</h2></div></div></div><p>Since <span class="strong"><strong>Camel 2.3</strong></span> the <code class="literal">JpaComponent</code> will auto lookup the
<code class="literal">TransactionManager</code> from the Registry. If Camel
won&#8217;t find any <code class="literal">TransactionManager</code> instance registered, it will also
look up for the&nbsp;<code class="literal">TransactionTemplate</code> and try to
extract&nbsp;<code class="literal">TransactionManager</code> from it.</p><p>If none <code class="literal">TransactionTemplate</code> is available in the registry,
<code class="literal">JpaEndpoint</code> will auto create their own instance of
<code class="literal">TransactionManager</code> which most often is not what you want.</p><p>If more than single instance of the <code class="literal">TransactionManager</code> is found, Camel
will log a WARN. In such cases you might want to instantiate and
explicitly configure a JPA component that references the
<code class="literal">myTransactionManager</code> transaction manager, as follows:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"jpa"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.jpa.JpaComponent"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
   <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"entityManagerFactory"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myEMFactory"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"transactionManager"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myTransactionManager"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_consumer_with_a_named_query"></a>Using a consumer with a named query</h2></div></div></div><p>For consuming only selected entities, you can use the
<code class="literal">consumer.namedQuery</code> URI query option. First, you have to define the
named query in the JPA Entity class:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Entity</span></em>
<em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@NamedQuery(name = "step1", query = "select x from MultiSteps x where x.step = 1")</span></em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MultiSteps {
   ...
}</pre><p>After that you can define a consumer uri like this one:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jpa://org.apache.camel.examples.MultiSteps?consumer.namedQuery=step1"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:myBusinessLogic"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_consumer_with_a_query"></a>Using a consumer with a query</h2></div></div></div><p>For consuming only selected entities, you can use the <code class="literal">consumer.query</code>
URI query option. You only have to define the query option:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jpa://org.apache.camel.examples.MultiSteps?consumer.query=select o from org.apache.camel.examples.MultiSteps o where o.step = 1"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:myBusinessLogic"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_consumer_with_a_native_query"></a>Using a consumer with a native query</h2></div></div></div><p>For consuming only selected entities, you can use the
<code class="literal">consumer.nativeQuery</code> URI query option. You only have to define the
native query option:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jpa://org.apache.camel.examples.MultiSteps?consumer.nativeQuery=select * from MultiSteps where step = 1"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:myBusinessLogic"</em></strong>);</pre><p>If you use the native query option, you will receive an object array in
the message body.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_producer_with_a_named_query"></a>Using a producer with a named query</h2></div></div></div><p>For retrieving selected entities or execute bulk update/delete, you can use the
<code class="literal">namedQuery</code> URI query option. First, you have to define the
named query in the JPA Entity class:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Entity</span></em>
<em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@NamedQuery(name = "step1", query = "select x from MultiSteps x where x.step = 1")</span></em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MultiSteps {
   ...
}</pre><p>After that you can define a producer uri like this one:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:namedQuery"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jpa://org.apache.camel.examples.MultiSteps?namedQuery=step1"</em></strong>);</pre><p>Note that you need to specify <code class="literal">useExecuteUpdate</code> option to <code class="literal">true</code> to execute <code class="literal">UPDATE</code>/<code class="literal">DELETE</code> statement
as a named query.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_producer_with_a_query"></a>Using a producer with a query</h2></div></div></div><p>For retrieving selected entities or execute bulk update/delete, you can use the <code class="literal">query</code>
URI query option. You only have to define the query option:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:query"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jpa://org.apache.camel.examples.MultiSteps?query=select o from org.apache.camel.examples.MultiSteps o where o.step = 1"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_producer_with_a_native_query"></a>Using a producer with a native query</h2></div></div></div><p>For retrieving selected entities or execute bulk update/delete, you can use the
<code class="literal">nativeQuery</code> URI query option. You only have to define the
native query option:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:nativeQuery"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jpa://org.apache.camel.examples.MultiSteps?resultClass=org.apache.camel.examples.MultiSteps&amp;nativeQuery=select * from MultiSteps where step = 1"</em></strong>);</pre><p>If you use the native query option without specifying <code class="literal">resultClass</code>, you will receive an object array in
the message body.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_example_11"></a>Example</h2></div></div></div><p>See <a class="link" href="http://camel.apache.org/tracer-example.html" target="_top">Tracer Example</a> for an example using
<a class="link" href="jpa-component.html" title="JPA Component">JPA</a> to store traced messages into a database.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_the_jpa_based_idempotent_repository"></a>Using the JPA-Based Idempotent Repository</h2></div></div></div><p>The Idempotent Consumer from the <a class="link" href="http://camel.apache.org/enterprise-integration-patterns.html" target="_top">EIP patterns</a> is used to filter out duplicate messages. A JPA-based idempotent repository is provided.</p><p>To use the JPA based idempotent repository.</p><div class="orderedlist"><p class="title"><b>Procedure</b></p><ol class="orderedlist" type="1"><li class="listitem">Set up a <code class="literal">persistence-unit</code> in the persistence.xml file:</li><li class="listitem">Set up a <code class="literal">org.springframework.orm.jpa.JpaTemplate</code>
which is used by the
<code class="literal">org.apache.camel.processor.idempotent.jpa.JpaMessageIdRepository</code>:</li><li class="listitem">Configure the error formatting macro: snippet: java.lang.IndexOutOfBoundsException:
Index: 20, Size: 20</li><li class="listitem">Configure the idempotent repository:
<code class="literal">org.apache.camel.processor.idempotent.jpa.JpaMessageIdRepository</code>:</li><li class="listitem">Create the JPA idempotent repository in the Spring XML file:</li></ol></div><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"JpaMessageIdRepositoryTest"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:start"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096"> /&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;idempotentConsumer</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">messageIdRepositoryRef</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"jpaStore"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;header&gt;</strong>messageId<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/header&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:result"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096"> /&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/idempotentConsumer&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p><span class="strong"><strong>When running this Camel component tests inside your IDE</strong></span></p><p>If you run the
<a class="link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-jpa/src/test" target="_top">tests
of this component</a> directly inside your IDE, and not through
Maven, then you could see exceptions like these:</p><pre class="programlisting">org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">for</strong> transaction; nested exception is
&lt;openjpa-<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">2.2</span>.<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">1</span>-r422266:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">1396819</span> nonfatal user error&gt; org.apache.openjpa.persistence.ArgumentException: This configuration disallows runtime optimization,
but the following listed types were not enhanced at build time or at <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> load time with a javaagent: <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"org.apache.camel.examples.SendEmail"</em></strong>.
    at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">427</span>)
    at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">371</span>)
    at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">127</span>)
    at org.apache.camel.processor.jpa.JpaRouteTest.cleanupRepository(JpaRouteTest.java:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">96</span>)
    at org.apache.camel.processor.jpa.JpaRouteTest.createCamelContext(JpaRouteTest.java:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">67</span>)
    at org.apache.camel.test.junit4.CamelTestSupport.doSetUp(CamelTestSupport.java:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">238</span>)
    at org.apache.camel.test.junit4.CamelTestSupport.setUp(CamelTestSupport.java:<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">208</span>)</pre><p>The problem here is that the source has been compiled or recompiled through
your IDE and not through Maven, which would
<a class="link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-jpa/pom.xml" target="_top">enhance
the byte-code at build time</a>. To overcome this you need to enable
<a class="link" href="http://openjpa.apache.org/entity-enhancement.html#dynamic-enhancement" target="_top">dynamic
byte-code enhancement of OpenJPA</a>. For example, assuming the current
OpenJPA version being used in Camel is 2.2.1, to run the
tests inside your IDE you would need to pass the following
argument to the JVM:</p><pre class="programlisting">-javaagent:&lt;path_to_your_local_m2_cache&gt;/org/apache/openjpa/openjpa/<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">2.2</span>.<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">1</span>/openjpa-<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">2.2</span>.1.jar</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_69"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://camel.apache.org/configuring-camel.html" target="_top">Configuring Camel</a></li><li class="listitem"><a class="link" href="http://camel.apache.org/component.html" target="_top">Component</a></li><li class="listitem"><a class="link" href="http://camel.apache.org/endpoint.html" target="_top">Endpoint</a></li><li class="listitem"><a class="link" href="http://camel.apache.org/getting-started.html" target="_top">Getting Started</a></li><li class="listitem"><a class="link" href="http://camel.apache.org/tracer-example.html" target="_top">Tracer Example</a></li></ul></div></div></div></body></html>