<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Paho Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="OpenTracing-OpenTracingComponent.html" title="OpenTracing Component"><link rel="next" href="paxlogging-component.html" title="OSGi PAX Logging Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="paho-component"></a>Paho Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="paho-component.html#_uri_format_148">URI format</a></span></dt><dt><span class="section"><a href="paho-component.html#_options_112">Options</a></span></dt><dt><span class="section"><a href="paho-component.html#_headers_17">Headers</a></span></dt><dt><span class="section"><a href="paho-component.html#_default_payload_type">Default payload type</a></span></dt><dt><span class="section"><a href="paho-component.html#_samples_33">Samples</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.16</strong></span></p><p>Paho component provides connector for the MQTT messaging protocol using
the <a class="link" href="https://eclipse.org/paho/" target="_top">Eclipse Paho</a> library. Paho is one of the
most popular MQTT libraries, so if you would like to integrate it with
your Java project - Camel Paho connector is a way to go.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-paho<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.y.z<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><p>Keep in mind that Paho artifacts are not hosted in the Maven Central, so
you need to add Eclipse Paho repository to your POM xml file:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;repositories&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;repository&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;id&gt;</strong>eclipse-paho<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/id&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;url&gt;</strong>https://repo.eclipse.org/content/repositories/paho-releases<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/url&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;snapshots&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;enabled&gt;</strong>false<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/enabled&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/snapshots&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/repository&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/repositories&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_148"></a>URI format</h2></div></div></div><pre class="screen">paho:topic[?options]</pre><p>Where <span class="strong"><strong>topic</strong></span> is the name of the topic.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_112"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="paho-component.html#_path_parameters_1_parameters_139">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="paho-component.html#_query_parameters_14_parameters_8">Query Parameters (14 parameters):</a></span></dt></dl></div><p>The Paho component supports 4 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>brokerUrl</strong></span> (common)</p></td><td align="left" valign="top"><p>The URL of the MQTT broker.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>clientId</strong></span> (common)</p></td><td align="left" valign="top"><p>MQTT client identifier.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>connectOptions</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Client connection options</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>MqttConnectOptions</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Paho endpoint is configured using URI syntax:</p><pre class="screen">paho:topic</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_139"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>topic</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Name of the topic</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_14_parameters_8"></a>Query Parameters (14 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>autoReconnect</strong></span> (common)</p></td><td align="left" valign="top"><p>Client will automatically attempt to reconnect to the server if the connection is lost</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>brokerUrl</strong></span> (common)</p></td><td align="left" valign="top"><p>The URL of the MQTT broker.</p></td><td align="center" valign="top"><p>tcp://localhost:1883</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>clientId</strong></span> (common)</p></td><td align="left" valign="top"><p>MQTT client identifier.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>connectOptions</strong></span> (common)</p></td><td align="left" valign="top"><p>Client connection options</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>MqttConnectOptions</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>filePersistenceDirectory</strong></span> (common)</p></td><td align="left" valign="top"><p>Base directory used by the file persistence provider.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>password</strong></span> (common)</p></td><td align="left" valign="top"><p>Password to be used for authentication against the MQTT broker</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>persistence</strong></span> (common)</p></td><td align="left" valign="top"><p>Client persistence to be used - memory or file.</p></td><td align="center" valign="top"><p>MEMORY</p></td><td align="left" valign="top"><p>PahoPersistence</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>qos</strong></span> (common)</p></td><td align="left" valign="top"><p>Client quality of service level (0-2).</p></td><td align="center" valign="top"><p>2</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>retained</strong></span> (common)</p></td><td align="left" valign="top"><p>Retain option</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>userName</strong></span> (common)</p></td><td align="left" valign="top"><p>Username to be used for authentication against the MQTT broker</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_headers_17"></a>Headers</h2></div></div></div><p>The following headers are recognized by the Paho component:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="10%" class="col_3"><col width="10%" class="col_4"><col width="60%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Java constant</th><th align="left" valign="top">Endpoint type</th><th align="left" valign="top">Value type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>CamelMqttTopic</p></td><td align="left" valign="top"><p>PahoConstants.MQTT_TOPIC</p></td><td align="left" valign="top"><p>Consumer</p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>The name of the topic</p></td></tr><tr><td align="left" valign="top"><p>CamelPahoOverrideTopic</p></td><td align="left" valign="top"><p>PahoConstants.CAMEL_PAHO_OVERRIDE_TOPIC</p></td><td align="left" valign="top"><p>Producer</p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Name of topic to override and send to instead of topic specified on endpoint</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_default_payload_type"></a>Default payload type</h2></div></div></div><p>By default Camel Paho component operates on the binary payloads
extracted out of (or put into) the MQTT message:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Receive payload</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">byte</strong>[] payload = (<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">byte</strong>[]) consumerTemplate.receiveBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"paho:topic"</em></strong>);

<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Send payload</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">byte</strong>[] payload = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"message"</em></strong>.getBytes();
producerTemplate.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"paho:topic"</em></strong>, payload);</pre><p>But of course Camel build-in&nbsp;<a class="link" href="type-converter.html" target="_top">type conversion
API</a> can perform the automatic data type transformations for you. In the
example below Camel automatically converts binary payload into <code class="literal">String</code>
(and&nbsp;conversely):</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Receive payload</em>
String payload = consumerTemplate.receiveBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"paho:topic"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);

<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Send payload</em>
String payload = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"message"</em></strong>;
producerTemplate.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"paho:topic"</em></strong>, payload);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_samples_33"></a>Samples</h2></div></div></div><p>For example the following snippet reads messages from the MQTT broker
installed on the same host as the Camel router:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"paho:some/queue"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:test"</em></strong>);</pre><p>While the snippet below sends message to the MQTT broker:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:test"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"paho:some/target/queue"</em></strong>);</pre><p>For example this is how to&nbsp;read messages from the remote MQTT broker:&nbsp;</p><pre class="screen">from("paho:some/queue?brokerUrl=tcp://iot.eclipse.org:1883")
    .to("mock:test");</pre><p>And here we override the default topic and set to a dynamic topic</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:test"</em></strong>)
    .setHeader(PahoConstants.CAMEL_PAHO_OVERRIDE_TOPIC, simple(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"${header.customerId}"</em></strong>))
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"paho:some/target/queue"</em></strong>);</pre></div></div></body></html>