<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Tracing a message through a route</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="RiderEclipseHelp.html" title="Part&nbsp;I.&nbsp;Tooling Tutorials"><link rel="prev" href="RiderTutorialDebug.html" title="Debugging a routing context"><link rel="next" href="RiderTutorialJUnit.html" title="Testing a route with JUnit"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="RiderTutorialTrace"></a>Tracing a message through a route</h2></div></div></div><p>Tracing allows you to intercept a message as it is routed from one node to another. You can trace messages through your routing context to see where you can optimize and fine tune your routing context&#8217;s performance.
This tutorial shows you how to trace a message through a route.</p><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_goals_7"></a>Goals</h2></div></div></div><p>In this tutorial you complete the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Run the <code class="literal">ZooOrderApp</code> in the <span class="strong"><strong>Fuse Integration</strong></span> perspective</li><li class="listitem">Enable tracing on the <code class="literal">ZooOrderApp</code></li><li class="listitem">Drop messages onto the <code class="literal">ZooOrderApp</code> and track them through all route nodes</li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_prerequisites_6"></a>Prerequisites</h2></div></div></div><p>To start this tutorial, you need the <span class="strong"><strong>ZooOrderApp</strong></span> project resulting from one of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">Complete the <a class="xref" href="RiderTutorialAddRoute.html" title="Adding another route to the routing context"><i>Adding another route to the routing context</i></a> tutorial.</p><p class="simpara">or</p></li><li class="listitem">Complete the <a class="xref" href="RiderTutorialSetup.html" title="Setting up your environment"><i>Setting up your environment</i></a>  tutorial and replace your project&#8217;s <code class="literal">blueprint.xml</code> file with the provided <code class="literal">blueprintContexts/blueprint3.xml</code> file, as described in <a class="xref" href="RiderTutorialIntro.html#AboutResourceFiles" title="About the resource files">About the resource files</a>.</li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_setting_up_your_fuse_integration_perspective"></a>Setting up your Fuse Integration perspective</h2></div></div></div><p>To set up your workspace to facilitate message tracing:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Click the
<span class="inlinemediaobject"><img src="./images/new_persp2.png" alt="Open Perspective icon"></span> button on the right side of the tool bar, and then select
<span class="strong"><strong>Fuse Integration</strong></span> from the list:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutPerspListFIPselected.png" alt="tutPerspListFIPselected"></div></div><p class="simpara">The <span class="strong"><strong>Fuse Integration</strong></span> perspective opens in the default layout:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutFIP_63.png" alt="TutFIP 63"></div></div></li><li class="listitem"><p class="simpara">Drag the <span class="strong"><strong>JMX Navigator</strong></span> tab to the far right of the <span class="strong"><strong>Terminal</strong></span> tab and drop it there:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/ftTutFIPrearrange.png" alt="ftTutFIPrearrange"></div></div><p class="simpara">This arrangement provides more space for <span class="strong"><strong>Diagram View</strong></span> to
display the routing context&#8217;s nodes graphically, which makes it easier for you
to visually trace the path that messages take in traversing the routing
context.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To make it easy to access a routing context <code class="literal">.xml</code> file, especially when a
project consists of multiple contexts, the tooling lists them under the
<code class="literal">Camel Contexts</code> folder in <span class="strong"><strong>Project Explorer</strong></span>.</p><p>Additionally, all routes in a routing context are displayed as icons
directly under their context file entry. To display a single route in the
routing context on the canvas, double-click its icon in <span class="strong"><strong>Project
Explorer</strong></span>. To display all routes in the routing context,
double-click the context file entry.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutCamelContextsFolderPE.png" alt="TutCamelContextsFolderPE"></div></div></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_starting_message_tracing"></a>Starting message tracing</h2></div></div></div><p>To start message tracing on the <code class="literal">ZooOrderApp</code> project:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In <span class="strong"><strong>Project Explorer</strong></span>, expand the
<code class="literal">ZooOrderApp</code> project to expose
<code class="literal">src/main/resources/OSGI-INF/blueprint/blueprint.xml</code>.</li><li class="listitem">Right-click
<code class="literal">src/main/resources/OSGI-INF/blueprint/blueprint.xml</code>
to open the context menu.</li><li class="listitem"><p class="simpara">Select <span class="strong"><strong>Run As</strong></span> &#8594; <span class="strong"><strong>Local Camel Context (without tests)</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you select <span class="strong"><strong>Local Camel Context</strong></span>, the tooling reverts to running
without tests because you have not yet created a JUnit test for the
<code class="literal">ZooOrderApp</code> project. You will do that later in <a class="xref" href="RiderTutorialJUnit.html" title="Testing a route with JUnit"><i>Testing a route with JUnit</i></a>.</p></td></tr></table></div></li><li class="listitem"><p class="simpara">In <span class="strong"><strong>JMX Navigator</strong></span>, expand <code class="literal">Local
Processes</code>.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgTrJMXLocalProcessess.png" alt="tutMsgTrJMXLocalProcessess"></div></div></li><li class="listitem">Right-click the <code class="literal">maven [ID]</code> node and then select <span class="strong"><strong>Connect</strong></span>.</li><li class="listitem"><p class="simpara">Expand the elements of your route:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgTrJMXLCCexpanded.png" alt="tutMsgTrJMXLCCexpanded"></div></div></li><li class="listitem"><p class="simpara">Right-click the <code class="literal">Routes</code> node and then select <span class="strong"><strong>Start Tracing</strong></span>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutTraceStart.png" alt="tutTraceStart"></div></div><p class="simpara">The tooling displays a graphical representation of your routing context in
<span class="strong"><strong>Diagram View</strong></span>:</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutDiagramNodes.png" alt="tutDiagramNodes"></div></div><p class="simpara">To see all message flow paths clearly, you probably need to rearrange the nodes
by dragging them to fit neatly in the <span class="strong"><strong>Diagram View</strong></span> tab. You may also need
to adjust the size of the other views and tabs in Red Hat Developer Studio to
allow the <span class="strong"><strong>Diagram View</strong></span> tab to expand.</p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dropping_messages_on_the_running_zooorderapp_project"></a>Dropping messages on the running ZooOrderApp project</h2></div></div></div><p>To drop messages on the running ZooOrderApp project:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">In <span class="strong"><strong>Project Explorer</strong></span>, expand
<code class="literal">ZooOrderApp/src/data</code>, so that you can access the message files
(<code class="literal">message1.xml</code> through <code class="literal">message6.xml</code>):</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutMsgFiles.png" alt="tutMsgFiles"></div></div></li><li class="listitem"><p class="simpara"><a name="msg1drag"></a> Drag <code class="literal">message1.xml</code> and drop it on the
<code class="literal">_context1&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
<span class="strong"><strong>JMX Navigator</strong></span>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutJMXLocalCntxtExpanded.png" alt="tutJMXLocalCntxtExpanded"></div></div><p class="simpara">As the message traverses the route, the tooling traces and records its passage
at each step.</p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuring_messages_view"></a>Configuring Messages View</h2></div></div></div><p>You must refresh the <span class="strong"><strong>Messages View</strong></span> before it will display
message traces. You also need to configure the columns in <span class="strong"><strong>Messages
View</strong></span> if you want them to persist across all message traces.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Open the <span class="strong"><strong>Messages View</strong></span>.</li><li class="listitem">Click the
<span class="inlinemediaobject"><img src="./images/refresh.png" alt="refresh"></span> (Refresh button) on top, right of the panel&#8217;s menu bar to
populate the view with <code class="literal">message1.xml</code>'s message
traces.</li><li class="listitem"><p class="simpara">Click the
<span class="inlinemediaobject"><img src="images/ViewMnuIcon.png" alt="View Menu icon"></span> icon on the panel&#8217;s menu bar, and select
<span class="strong"><strong>Configure Columns</strong></span> to open the <span class="strong"><strong>Configure Columns</strong></span> wizard:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutConfigColsDefaults.png" alt="TutConfigColsDefaults"></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Notice that the message header, <span class="strong"><strong>Destination</strong></span>, which you
set for the messages in your routing context, appears in the list.</p></td></tr></table></div><p class="simpara">You can include or exclude items from <span class="strong"><strong>Messages View</strong></span> by
selecting or deselecting them. You can rearrange the columnar order in which
items appear in <span class="strong"><strong>Messages View</strong></span> by highlighting individual,
selected items and moving them up or down in the list.</p></li><li class="listitem"><p class="simpara">In the <span class="strong"><strong>Configure Columns</strong></span> wizard, select and order the
columns this way:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgVCnfgColsMnu.png" alt="tutMsgVCnfgColsMnu"></div></div><p class="simpara">These columns and their order will persist in <span class="strong"><strong>Messages View</strong></span>
until you change them again.</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can control columnar layout in all of the tooling&#8217;s tables. Use the
drag method to temporarily rearrange tabular format. For example, drag a
column&#8217;s border rule to expand or contract its width. To hide a column,
totally contract its borders. Drag the column header to relocate a column
within the table. For your arrangement to persist, you must use the <span class="strong"><strong>View</strong></span> &#8594; <span class="strong"><strong>Configure Columns</strong></span> method instead.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_stepping_through_message_traces"></a>Stepping through message traces</h2></div></div></div><p>To step through the message traces:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Drag <code class="literal">message2.xml</code> and drop it on
the <code class="literal">_context1&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
<span class="strong"><strong>JMX Navigator</strong></span>.</li><li class="listitem">Switch from <span class="strong"><strong>Console</strong></span> to <span class="strong"><strong>Messages View</strong></span>.</li><li class="listitem"><p class="simpara">In <span class="strong"><strong>Messages View</strong></span>, click the
<span class="inlinemediaobject"><img src="./images/refresh.png" alt="refresh"></span> (Refresh button) to populate the view with <code class="literal">message2.xml</code> message
traces.</p><p class="simpara">Each time you drop a message on in <span class="strong"><strong>JMX Navigator</strong></span>, you need to refresh <span class="strong"><strong>Messages View</strong></span>
to populate it with the message traces.</p></li><li class="listitem"><p class="simpara"><a name="msgView"></a> Click one of the message traces to see more details about it in
<span class="strong"><strong>Properties</strong></span> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutTraceDetails2.png" alt="tutTraceDetails2"></div></div><p class="simpara">The tooling displays the details about a message trace (including message
headers when they are set) in the top half of the
<span class="strong"><strong>Properties</strong></span> view and the contents of the message
instance in the bottom half of the <span class="strong"><strong>Properties</strong></span> view. So, if
your application sets headers at any step within a route, you can check the
<span class="strong"><strong>Message Details</strong></span> to see whether they were set as
expected.</p><p class="simpara">You can step through the message instances by highlighting each one to see how
a particular message traversed the route and whether it was processed as
expected at each step in the route.</p></li><li class="listitem"><p class="simpara">Open <span class="strong"><strong>Diagram View</strong></span>, to see that the associated step in the route is
highlighted:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutMsgTraceDiagNode.png" alt="TutMsgTraceDiagNode"></div></div><p class="simpara">The tooling draws the route in <span class="strong"><strong>Diagram View</strong></span>, tagging
paths exiting a processing step with timing and performance metrics (in
milliseconds). Only the metric <span class="strong"><strong>Total exchanges</strong></span> is displayed
in the diagram.</p></li><li class="listitem"><p class="simpara">Hover the mouse pointer over the displayed metrics to reveal additional metrics about message
flow:</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutDVnodeMetrics.png" alt="tutDVnodeMetrics"></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Mean time the step took to process a message</li><li class="listitem">Maximum time the step took to process a message</li><li class="listitem">Minimum time the step took to process a message</li></ul></div></li><li class="listitem"><p class="simpara">Optionally, you can drag and drop the remaining messages in <code class="literal">ZooOrderApp/src/data/</code> into the  <code class="literal">_context1&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
<span class="strong"><strong>JMX Navigator</strong></span> at any time, as long as tracing remains enabled.</p><p class="simpara">On each subsequent drop, remember to click the <span class="inlinemediaobject"><img src="./images/refresh.png" alt="refresh"></span> (Refresh button) to populate <span class="strong"><strong>Messages View</strong></span> with the new message traces.</p></li><li class="listitem"><p class="simpara">When done:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">In <span class="strong"><strong>JMX Navigator</strong></span>, right-click <code class="literal">_context1</code> and select <span class="strong"><strong>Stop Tracing Context</strong></span>.</li><li class="listitem">Open the <span class="strong"><strong>Console</strong></span> and click the
<span class="inlinemediaobject"><img src="images/ConsoleStopButton.jpg" alt="Stop icon"></span> button in the upper right of the panel to stop
the Console. Then click the
<span class="inlinemediaobject"><img src="images/clear_co.png" alt="Clear icon"></span> button to clear console output.</li></ul></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_next_steps_7"></a>Next steps</h2></div></div></div><p>In the <a class="xref" href="RiderTutorialJUnit.html" title="Testing a route with JUnit"><i>Testing a route with JUnit</i></a> tutorial, you create a JUnit test case for your project and run your project as a
<code class="literal">Local Camel Context</code>.</p></div></div></body></html>