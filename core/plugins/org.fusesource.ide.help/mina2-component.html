<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Mina2 Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="mime-multipart-dataformat.html" title="MIME Multipart DataFormat"><link rel="next" href="mllp-component.html" title="MLLP Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="mina2-component"></a>Mina2 Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="mina2-component.html#_uri_format_124">URI format</a></span></dt><dt><span class="section"><a href="mina2-component.html#_options_101">Options</a></span></dt><dt><span class="section"><a href="mina2-component.html#_using_a_custom_codec">Using a custom codec</a></span></dt><dt><span class="section"><a href="mina2-component.html#_sample_with_sync_false">Sample with sync=false</a></span></dt><dt><span class="section"><a href="mina2-component.html#_sample_with_sync_true">Sample with sync=true</a></span></dt><dt><span class="section"><a href="mina2-component.html#_sample_with_spring_dsl">Sample with Spring DSL</a></span></dt><dt><span class="section"><a href="mina2-component.html#_closing_session_when_complete">Closing Session When Complete</a></span></dt><dt><span class="section"><a href="mina2-component.html#_get_the_iosession_for_message">Get the IoSession for message</a></span></dt><dt><span class="section"><a href="mina2-component.html#_configuring_mina_filters">Configuring Mina filters</a></span></dt><dt><span class="section"><a href="mina2-component.html#_see_also_80">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.10</strong></span></p><p>The <span class="strong"><strong>mina2:</strong></span> component is a transport for working with
<a class="link" href="http://mina.apache.org/" target="_top">Apache MINA 2.x</a></p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Favor using <a class="link" href="netty-component.html" title="Netty Component (deprecated)">Netty</a> as Netty is a much more active
maintained and popular project than Apache Mina currently is</p></td></tr></table></div><p>INFO: Be careful with sync=false on consumer endpoints. Since camel-mina2 all
consumer exchanges are InOut. This is different to camel-mina.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-mina2<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_124"></a>URI format</h2></div></div></div><pre class="programlisting">mina2:tcp:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//hostname[:port][?options]</em>
mina2:udp:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//hostname[:port][?options]</em>
mina2:vm:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//hostname[:port][?options]</em></pre><p>You can specify a codec in the Registry using the
<span class="strong"><strong>codec</strong></span> option. If you are using TCP and no codec is specified then the
<code class="literal">textline</code> flag is used to determine if text line based codec or object
serialization should be used instead. By default the object
serialization is used.</p><p>For UDP if no codec is specified the default uses a basic <code class="literal">ByteBuffer</code>
based codec.</p><p>The VM protocol is used as a direct forwarding mechanism in the same
JVM.</p><p>A Mina producer has a default timeout value of 30 seconds, while it
waits for a response from the remote server.</p><p>In normal use, <code class="literal">camel-mina</code> only supports marshalling the body
content&#8212;message headers and exchange properties are not sent.
 However, the option, <span class="strong"><strong>transferExchange</strong></span>, does allow you to transfer the
exchange itself over the wire. See options below.</p><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_101"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="mina2-component.html#_path_parameters_3_parameters_11">Path Parameters (3 parameters):</a></span></dt><dt><span class="section"><a href="mina2-component.html#_query_parameters_27_parameters_9">Query Parameters (27 parameters):</a></span></dt></dl></div><p>The Mina2 component supports 3 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>configuration</strong></span> (advanced)</p></td><td align="left" valign="top"><p>To use the shared mina configuration.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Mina2Configuration</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useGlobalSslContext Parameters</strong></span> (security)</p></td><td align="left" valign="top"><p>Enable usage of global SSL context parameters.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Mina2 endpoint is configured using URI syntax:</p><pre class="screen">mina2:protocol:host:port</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_3_parameters_11"></a>Path Parameters (3 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>protocol</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Protocol to use</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>host</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Hostname to use. Use localhost or 0.0.0.0 for local server as consumer. For producer use the hostname or ip address of the remote server.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>port</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Port number</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_27_parameters_9"></a>Query Parameters (27 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>disconnect</strong></span> (common)</p></td><td align="left" valign="top"><p>Whether or not to disconnect(close) from Mina session right after use. Can be used for both consumer and producer.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>minaLogger</strong></span> (common)</p></td><td align="left" valign="top"><p>You can enable the Apache MINA logging filter. Apache MINA uses slf4j logging at INFO level to log all input and output.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sync</strong></span> (common)</p></td><td align="left" valign="top"><p>Setting to set endpoint as one-way or request-response.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>timeout</strong></span> (common)</p></td><td align="left" valign="top"><p>You can configure the timeout that specifies how long to wait for a response from a remote server. The timeout unit is in milliseconds, so 60000 is 60 seconds.</p></td><td align="center" valign="top"><p>30000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>writeTimeout</strong></span> (common)</p></td><td align="left" valign="top"><p>Maximum amount of time it should take to send data to the MINA session. Default is 10000 milliseconds.</p></td><td align="center" valign="top"><p>10000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>clientMode</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If the clientMode is true, mina consumer will connect the address as a TCP client.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>disconnectOnNoReply</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If sync is enabled then this option dictates MinaConsumer if it should disconnect where there is no reply to send back.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>noReplyLogLevel</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If sync is enabled this option dictates MinaConsumer which logging level to use when logging a there is no reply to send back.</p></td><td align="center" valign="top"><p>WARN</p></td><td align="left" valign="top"><p>LoggingLevel</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>cachedAddress</strong></span> (producer)</p></td><td align="left" valign="top"><p>Whether to create the InetAddress once and reuse. Setting this to false allows to pickup DNS changes in the network.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>lazySessionCreation</strong></span> (producer)</p></td><td align="left" valign="top"><p>Sessions can be lazily created to avoid exceptions, if the remote server is not up and running when the Camel producer is started.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maximumPoolSize</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Number of worker threads in the worker pool for TCP and UDP</p></td><td align="center" valign="top"><p>16</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>orderedThreadPoolExecutor</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether to use ordered thread pool, to ensure events are processed orderly on the same channel.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>transferExchange</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Only used for TCP. You can transfer the exchange over the wire instead of just the body. The following fields are transferred: In body, Out body, fault body, In headers, Out headers, fault headers, exchange properties, exchange exception. This requires that the objects are serializable. Camel will exclude any non-serializable objects and log it at WARN level.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>allowDefaultCodec</strong></span> (codec)</p></td><td align="left" valign="top"><p>The mina component installs a default codec if both, codec is null and textline is false. Setting allowDefaultCodec to false prevents the mina component from installing a default codec as the first element in the filter chain. This is useful in scenarios where another filter must be the first in the filter chain, like the SSL filter.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>codec</strong></span> (codec)</p></td><td align="left" valign="top"><p>To use a custom minda codec implementation.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ProtocolCodecFactory</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>decoderMaxLineLength</strong></span> (codec)</p></td><td align="left" valign="top"><p>To set the textline protocol decoder max line length. By default the default value of Mina itself is used which are 1024.</p></td><td align="center" valign="top"><p>1024</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>encoderMaxLineLength</strong></span> (codec)</p></td><td align="left" valign="top"><p>To set the textline protocol encoder max line length. By default the default value of Mina itself is used which are Integer.MAX_VALUE.</p></td><td align="center" valign="top"><p>-1</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>encoding</strong></span> (codec)</p></td><td align="left" valign="top"><p>You can configure the encoding (a charset name) to use for the TCP textline codec and the UDP protocol. If not provided, Camel will use the JVM default Charset</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>filters</strong></span> (codec)</p></td><td align="left" valign="top"><p>You can set a list of Mina IoFilters to use.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>List</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>textline</strong></span> (codec)</p></td><td align="left" valign="top"><p>Only used for TCP. If no codec is specified, you can use this flag to indicate a text line based codec; if not specified or the value is false, then Object Serialization is assumed over TCP.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>textlineDelimiter</strong></span> (codec)</p></td><td align="left" valign="top"><p>Only used for TCP and if textline=true. Sets the text line delimiter to use. If none provided, Camel will use DEFAULT. This delimiter is used to mark the end of text.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Mina2TextLineDelimiter</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>autoStartTls</strong></span> (security)</p></td><td align="left" valign="top"><p>Whether to auto start SSL handshake.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sslContextParameters</strong></span> (security)</p></td><td align="left" valign="top"><p>To configure SSL security.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>SSLContextParameters</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_custom_codec"></a>Using a custom codec</h2></div></div></div><p>See the Mina how to write your own codec. To use your custom codec with
<code class="literal">camel-mina</code>, you should register your codec in the
Registry; for example, by creating a bean in the
Spring XML file. Then use the <code class="literal">codec</code> option to specify the bean ID of
your codec. See <a class="link" href="hl7-dataformat.html" title="HL7 DataFormat">HL7</a> that has a custom codec.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_sample_with_sync_false"></a>Sample with sync=false</h2></div></div></div><p>In this sample, Camel exposes a service that listens for TCP connections
on port 6200. We use the <span class="strong"><strong>textline</strong></span> codec. In our route, we create a
Mina consumer endpoint that listens on port 6200:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mina2:tcp://localhost:"</em></strong> + port1 + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"?textline=true&amp;sync=false"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre><p>As the sample is part of a unit test, we test it by sending some data to
it on port 6200.</p><pre class="programlisting">MockEndpoint mock = getMockEndpoint(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);
mock.expectedBodiesReceived(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hello World"</em></strong>);

template.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mina2:tcp://localhost:"</em></strong> + port1 + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"?textline=true&amp;sync=false"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hello World"</em></strong>);

assertMockEndpointsSatisfied();</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_sample_with_sync_true"></a>Sample with sync=true</h2></div></div></div><p>In the next sample, we have a more common use case where we expose a TCP
service on port 6201 also use the textline codec. However, this time we
want to return a response, so we set the <code class="literal">sync</code> option to <code class="literal">true</code> on the
consumer.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mina2:tcp://localhost:"</em></strong> + port2 + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"?textline=true&amp;sync=true"</em></strong>).process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Processor() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> process(Exchange exchange) <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        String body = exchange.getIn().getBody(String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
        exchange.getOut().setBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Bye "</em></strong> + body);
    }
});</pre><p>Then we test the sample by sending some data and retrieving the response
using the <code class="literal">template.requestBody()</code> method. As we know the response is a
<code class="literal">String</code>, we cast it to <code class="literal">String</code> and can assert that the response is, in
fact, something we have dynamically set in our processor code logic.</p><pre class="programlisting">String response = (String)template.requestBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mina2:tcp://localhost:"</em></strong> + port2 + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"?textline=true&amp;sync=true"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"World"</em></strong>);
assertEquals(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Bye World"</em></strong>, response);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_sample_with_spring_dsl"></a>Sample with Spring DSL</h2></div></div></div><p>Spring DSL can, of course, also be used for <a class="link" href="mina2-component.html" title="Mina2 Component">MINA</a>. In the
sample below we expose a TCP server on port 5555:</p><pre class="programlisting">   <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
     <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mina2:tcp://localhost:5555?textline=true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
     <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"bean:myTCPOrderHandler"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>In the route above, we expose a TCP server on port 5555 using the
textline codec. We let the Spring bean with ID, <code class="literal">myTCPOrderHandler</code>,
handle the request and return a reply. For instance, the handler bean
could be implemented as follows:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> String handleOrder(String payload) {
        ...
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Order: OK"</em></strong>
   }</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_closing_session_when_complete"></a>Closing Session When Complete</h2></div></div></div><p>When acting as a server you sometimes want to close the session when,
for example, a client conversion is finished. To instruct Camel to close
the session, you should add a header with the key
<code class="literal">CamelMinaCloseSessionWhenComplete</code> set to a boolean <code class="literal">true</code> value.</p><p>For instance, the example below will close the session after it has
written the <code class="literal">bye</code> message back to the client:</p><pre class="programlisting">        from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mina2:tcp://localhost:8080?sync=true&amp;textline=true"</em></strong>).process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Processor() {
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> process(Exchange exchange) <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
                String body = exchange.getIn().getBody(String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
                exchange.getOut().setBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Bye "</em></strong> + body);
                exchange.getOut().setHeader(Mina2Constants.MINA_CLOSE_SESSION_WHEN_COMPLETE, true);
            }
        });</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_get_the_iosession_for_message"></a>Get the IoSession for message</h2></div></div></div><p>You can get the IoSession from the message header with this key
<code class="literal">Mina2Constants.MINA_IOSESSION</code>, and also get the local host address
with the key <code class="literal">Mina2Constants.MINA_LOCAL_ADDRESS</code> and remote host address
with the key <code class="literal">Mina2Constants.MINA_REMOTE_ADDRESS</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuring_mina_filters"></a>Configuring Mina filters</h2></div></div></div><p>Filters permit you to use some Mina Filters, such as <code class="literal">SslFilter</code>. You
can also implement some customized filters. Please note that <code class="literal">codec</code> and
<code class="literal">logger</code> are also implemented as Mina filters of type, <code class="literal">IoFilter</code>. Any
filters you may define are appended to the end of the filter chain; that
is, after <code class="literal">codec</code> and <code class="literal">logger</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_80"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li><li class="listitem"><a class="link" href="netty-component.html" title="Netty Component (deprecated)">Netty</a></li></ul></div></div></div></body></html>