<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>CouchDB Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="couchbase-component.html" title="Couchbase Component"><link rel="next" href="cql-component.html" title="Cassandra CQL Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="couchdb-component"></a>CouchDB Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="couchdb-component.html#_uri_format_49">URI format</a></span></dt><dt><span class="section"><a href="couchdb-component.html#_options_25">Options</a></span></dt><dt><span class="section"><a href="couchdb-component.html#_headers_3">Headers</a></span></dt><dt><span class="section"><a href="couchdb-component.html#_message_body_4">Message Body</a></span></dt><dt><span class="section"><a href="couchdb-component.html#_samples_5">Samples</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.11</strong></span></p><p>The <span class="strong"><strong>couchdb:</strong></span> component allows you to treat
<a class="link" href="http://couchdb.apache.org/" target="_top">CouchDB</a> instances as a producer or consumer
of messages. Using the lightweight LightCouch API, this camel component
has the following features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">As a consumer, monitors couch changesets for inserts, updates and
deletes and publishes these as messages into camel routes.</li><li class="listitem">As a producer, can save, update and from Camel 2.18 delete (by using CouchDbMethod with DELETE value)
documents into couch.</li><li class="listitem">Can support as many endpoints as required, eg for multiple databases
across multiple instances.</li><li class="listitem">Ability to have events trigger for only deletes, only inserts/updates
or all (default).</li><li class="listitem">Headers set for sequenceId, document revision, document id, and HTTP
method type.</li></ul></div><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-couchdb<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_49"></a>URI format</h2></div></div></div><pre class="programlisting">couchdb:http:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//hostname[:port]/database?[options]</em></pre><p>Where <span class="strong"><strong>hostname</strong></span> is the hostname of the running couchdb instance. Port
is optional and if not specified then defaults to 5984.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_25"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="couchdb-component.html#_path_parameters_4_parameters_2">Path Parameters (4 parameters):</a></span></dt><dt><span class="section"><a href="couchdb-component.html#_query_parameters_12_parameters_3">Query Parameters (12 parameters):</a></span></dt></dl></div><p>The CouchDB component has no options.</p><p>The CouchDB endpoint is configured using URI syntax:</p><pre class="screen">couchdb:protocol:hostname:port/database</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_4_parameters_2"></a>Path Parameters (4 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>protocol</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The protocol to use for communicating with the database.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>hostname</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Hostname of the running couchdb instance</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>port</strong></span></p></td><td align="left" valign="top"><p>Port number for the running couchdb instance</p></td><td align="center" valign="top"><p>5984</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>database</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Name of the database to use</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_12_parameters_3"></a>Query Parameters (12 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>createDatabase</strong></span> (common)</p></td><td align="left" valign="top"><p>Creates the database if it does not already exist</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>deletes</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Document deletes are published as events</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>heartbeat</strong></span> (consumer)</p></td><td align="left" valign="top"><p>How often to send an empty message to keep socket alive in millis</p></td><td align="center" valign="top"><p>30000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>since</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Start tracking changes immediately after the given update sequence. The default, null, will start monitoring from the latest sequence.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>style</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Specifies how many revisions are returned in the changes array. The default, main_only, will only return the current winning revision; all_docs will return all leaf revisions (including conflicts and deleted former conflicts.)</p></td><td align="center" valign="top"><p>main_only</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>updates</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Document inserts/updates are published as events</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>password</strong></span> (security)</p></td><td align="left" valign="top"><p>Password for authenticated databases</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>username</strong></span> (security)</p></td><td align="left" valign="top"><p>Username in case of authenticated databases</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_headers_3"></a>Headers</h2></div></div></div><p>The following headers are set on exchanges during message transport.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="20%" class="col_1"><col width="80%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Property</th><th align="left" valign="top">Value</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CouchDbDatabase</code></p></td><td align="left" valign="top"><p>the database the message came from</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CouchDbSeq</code></p></td><td align="left" valign="top"><p>the couchdb changeset sequence number of the update / delete message</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CouchDbId</code></p></td><td align="left" valign="top"><p>the couchdb document id</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CouchDbRev</code></p></td><td align="left" valign="top"><p>the couchdb document revision</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CouchDbMethod</code></p></td><td align="left" valign="top"><p>the method (delete / update)</p></td></tr></tbody></table></div><p>Headers are set by the consumer once the message is received. The
producer will also set the headers for downstream processors once the
insert/update has taken place. Any headers set prior to the producer are
ignored. That means for example, if you set CouchDbId as a header, it
will not be used as the id for insertion, the id of the document will
still be used.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_body_4"></a>Message Body</h2></div></div></div><p>The component will use the message body as the document to be inserted.
If the body is an instance of String, then it will be marshalled into a
GSON object before insert. This means that the string must be valid JSON
or the insert / update will fail. If the body is an instance of a
com.google.gson.JsonElement then it will be inserted as is. Otherwise
the producer will throw an exception of unsupported body type.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_samples_5"></a>Samples</h2></div></div></div><p>For example if you wish to consume all inserts, updates and deletes from
a CouchDB instance running locally, on port 9999 then you could use the
following:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"couchdb:http://localhost:9999"</em></strong>).process(someProcessor);</pre><p>If you were only interested in deletes, then you could use the following</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"couchdb:http://localhost:9999?updates=false"</em></strong>).process(someProcessor);</pre><p>If you wanted to insert a message as a document, then the body of the
exchange is used</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"someProducingEndpoint"</em></strong>).process(someProcessor).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"couchdb:http://localhost:9999"</em></strong>)</pre></div></div></body></html>