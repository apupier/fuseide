<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Google Pubsub Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="google-mail-component.html" title="Google Mail Component"><link rel="next" href="groovy-language.html" title="Groovy Language"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="google-pubsub-component"></a>Google Pubsub Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="google-pubsub-component.html#_uri_format_85">URI Format</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_options_47">Options</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_producer_endpoints_9">Producer Endpoints</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_consumer_endpoints_8">Consumer Endpoints</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_message_headers_17">Message Headers</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_message_body_13">Message Body</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_authentication_configuration">Authentication Configuration</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_rollback_and_redelivery">Rollback and Redelivery</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.19</strong></span></p><p>The Google Pubsub component provides access
to <a class="link" href="https://cloud.google.com/pubsub/" target="_top">Cloud Pub/Sub Infrastructure</a>&nbsp;via
the <a class="link" href="https://cloud.google.com/apis/docs/client-libraries-explained" target="_top">Google Client Services API</a>.</p><p>The current implementation does not use gRPC.</p><p>Maven users will need to add the following dependency to their pom.xml
for this component:</p><pre class="screen">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-google-pubsub&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_85"></a>URI Format</h2></div></div></div><p>The GoogleMail Component uses the following URI format:</p><pre class="screen">google-pubsub://project-id:destinationName?[options]</pre><p>Destination Name can be either a topic or a subscription name.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_47"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="google-pubsub-component.html#_path_parameters_2_parameters_22">Path Parameters (2 parameters):</a></span></dt><dt><span class="section"><a href="google-pubsub-component.html#_query_parameters_9_parameters_3">Query Parameters (9 parameters):</a></span></dt></dl></div><p>The Google Pubsub component supports 2 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>connectionFactory</strong></span> (common)</p></td><td align="left" valign="top"><p>Sets the connection factory to use: provides the ability to explicitly manage connection credentials: - the path to the key file - the Service Account Key / Email pair</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GooglePubsubConnection Factory</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Google Pubsub endpoint is configured using URI syntax:</p><pre class="screen">google-pubsub:projectId:destinationName</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_2_parameters_22"></a>Path Parameters (2 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>projectId</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Project Id</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>destinationName</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Destination Name</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_9_parameters_3"></a>Query Parameters (9 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>ackMode</strong></span> (common)</p></td><td align="left" valign="top"><p>AUTO = exchange gets ack&#8217;ed/nack&#8217;ed on completion. NONE = downstream process has to ack/nack explicitly</p></td><td align="center" valign="top"><p>AUTO</p></td><td align="left" valign="top"><p>AckMode</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>concurrentConsumers</strong></span> (common)</p></td><td align="left" valign="top"><p>The number of parallel streams consuming from the subscription</p></td><td align="center" valign="top"><p>1</p></td><td align="left" valign="top"><p>Integer</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>connectionFactory</strong></span> (common)</p></td><td align="left" valign="top"><p>ConnectionFactory to obtain connection to PubSub Service. If non provided the default will be used.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GooglePubsubConnection Factory</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>loggerId</strong></span> (common)</p></td><td align="left" valign="top"><p>Logger ID to use when a match to the parent route required</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maxMessagesPerPoll</strong></span> (common)</p></td><td align="left" valign="top"><p>The max number of messages to receive from the server in a single API call</p></td><td align="center" valign="top"><p>1</p></td><td align="left" valign="top"><p>Integer</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_producer_endpoints_9"></a>Producer Endpoints</h2></div></div></div><p>Producer endpoints can accept and deliver to PubSub individual and grouped
exchanges alike. Grouped exchanges have <code class="literal">Exchange.GROUPED_EXCHANGE</code> property set.</p><p>Google PubSub expects the payload to be byte[] array, Producer endpoints will send:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">String body as byte[] encoded as UTF-8</li><li class="listitem">byte[] body as is</li><li class="listitem">Everything else will be serialised into byte[] array</li></ul></div><p>A Map set as message header <code class="literal">GooglePubsubConstants.ATTRIBUTES</code> will be sent as PubSub attributes.
Once exchange has been delivered to PubSub the PubSub Message ID will be assigned to
the header <code class="literal">GooglePubsubConstants.MESSAGE_ID</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_consumer_endpoints_8"></a>Consumer Endpoints</h2></div></div></div><p>Google PubSub will redeliver the message if it has not been acknowledged within the time period set
as a configuration option on the subscription.</p><p>The component will acknowledge the message once exchange processing has been completed.</p><p>If the route throws an exception, the exchange is marked as failed and the component will NACK the message -
it will be redelivered immediately.</p><p>To ack/nack the message the component uses Acknowledgement ID stored as header <code class="literal">GooglePubsubConstants.ACK_ID</code>.
If the header is removed or tampered with, the ack will fail and the message will be redelivered
again after the ack deadline.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_headers_17"></a>Message Headers</h2></div></div></div><p>Headers set by the consumer endpoints:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">GooglePubsubConstants.MESSAGE_ID</li><li class="listitem">GooglePubsubConstants.ATTRIBUTES</li><li class="listitem">GooglePubsubConstants.PUBLISH_TIME</li><li class="listitem">GooglePubsubConstants.ACK_ID</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_body_13"></a>Message Body</h2></div></div></div><p>The consumer endpoint returns the content of the message as byte[] - exactly as the underlying system sends it.
It is up for the route to convert/unmarshall the contents.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_authentication_configuration"></a>Authentication Configuration</h2></div></div></div><p>Google Pubsub component authentication is targeted for use with the GCP Service Accounts.
For more information please refer to <a class="link" href="https://cloud.google.com/docs/authentication" target="_top">Google Cloud Platform Auth Guide</a></p><p>Google security credentials can be set explicitly via one of the two options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Service Account Email and Service Account Key (PEM format)</li><li class="listitem">GCP credentials file location</li></ul></div><p>If both are set, the Service Account Email/Key will take precedence.</p><p>Or implicitly, where the connection factory falls back on
<a class="link" href="https://developers.google.com/identity/protocols/application-default-credentials#howtheywork" target="_top">Application Default Credentials</a>.</p><p><span class="strong"><strong>OBS!</strong></span> The location of the default credentials file is configurable - via GOOGLE_APPLICATION_CREDENTIALS environment variable.</p><p>Service Account Email and Service Account Key can be found in the GCP JSON credentials file as client_email and private_key respectively.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_rollback_and_redelivery"></a>Rollback and Redelivery</h2></div></div></div><p>The rollback for Google PubSub relies on the idea of the Acknowledgement Deadline - the time period where Google PubSub expects to receive the acknowledgement.
If the acknowledgement has not been received, the message is redelivered.</p><p>Google provides an API to extend the deadline for a message.</p><p>More information in <a class="link" href="https://cloud.google.com/pubsub/docs/subscriber#ack_deadline" target="_top">Google PubSub Documentation</a></p><p>So, rollback is effectively a deadline extension API call with zero value - i.e. deadline is reached now and message can
be redelivered to the next consumer.</p><p>It is possible to delay the message redelivery by setting the acknowledgement deadline explicitly for the rollback by
setting the message header <code class="literal">GooglePubsubConstants.ACK_DEADLINE</code> to the value in seconds.</p></div></div></body></html>