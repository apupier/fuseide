<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Groovy Language</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="google-pubsub-component.html" title="Google Pubsub Component"><link rel="next" href="grpc-component.html" title="gRPC Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="groovy-language"></a>Groovy Language</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="groovy-language.html#_groovy_options">Groovy Options</a></span></dt><dt><span class="section"><a href="groovy-language.html#_customizing_groovy_shell_2">Customizing Groovy Shell</a></span></dt><dt><span class="section"><a href="groovy-language.html#_example_6">Example</a></span></dt><dt><span class="section"><a href="groovy-language.html#_scriptcontext">ScriptContext</a></span></dt><dt><span class="section"><a href="groovy-language.html#_additional_arguments_to_scriptingengine">Additional arguments to ScriptingEngine</a></span></dt><dt><span class="section"><a href="groovy-language.html#_using_properties_function">Using properties function</a></span></dt><dt><span class="section"><a href="groovy-language.html#_loading_script_from_external_resource">Loading script from external resource</a></span></dt><dt><span class="section"><a href="groovy-language.html#_how_to_get_the_result_from_multiple_statements_script">How to get the result from multiple statements script</a></span></dt><dt><span class="section"><a href="groovy-language.html#_dependencies_35">Dependencies</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 1.3</strong></span></p><p>Camel supports <a class="link" href="http://groovy.codehaus.org/" target="_top">Groovy</a> among other
Scripting Languages to allow an
Expression or Predicate to be
used in the DSL or <a class="link" href="xml-configuration.html" target="_top">Xml
Configuration</a>.</p><p>To use a Groovy expression use the following Java code</p><pre class="programlisting">... groovy(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"someGroovyExpression"</em></strong>) ...</pre><p>For example you could use the <span class="strong"><strong>groovy</strong></span> function to create an
Predicate in a <a class="link" href="message-filter.html" target="_top">Message
Filter</a> or as an Expression for a
Recipient List</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_groovy_options"></a>Groovy Options</h2></div></div></div><p>The Groovy language supports 1 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="10%" class="col_3"><col width="60%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>trim</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to trim the value to remove leading and trailing whitespaces and line breaks</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_customizing_groovy_shell_2"></a>Customizing Groovy Shell</h2></div></div></div><p>Sometimes you may need to use custom <code class="literal">GroovyShell</code> instance in your
Groovy expressions. To provide custom <code class="literal">GroovyShell</code>, add implementation
of the&nbsp;<code class="literal">org.apache.camel.language.groovy.GroovyShellFactory</code> SPI
interface to your Camel registry. For example after adding the following
bean to your Spring context&#8230;&#8203;</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> CustomGroovyShellFactory <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">implements</strong> GroovyShellFactory {
&nbsp;
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> GroovyShell createGroovyShell(Exchange exchange) {
    ImportCustomizer importCustomizer = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ImportCustomizer();
    importCustomizer.addStaticStars(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"com.example.Utils"</em></strong>);
    CompilerConfiguration configuration = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> CompilerConfiguration();
    configuration.addCompilationCustomizers(importCustomizer);
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> GroovyShell(configuration);
  }

}</pre><p>&#8230;&#8203;Camel will use your custom GroovyShell instance (containing your
custom static imports), instead of the default one.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_example_6"></a>Example</h2></div></div></div><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// lets route if a line item is over $100</em>
from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:foo"</em></strong>).filter(groovy(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"request.lineItems.any { i -&gt; i.value &gt; 100 }"</em></strong>)).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:bar"</em></strong>)</pre><p>And the Spring DSL:</p><pre class="programlisting">        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"queue:foo"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;filter&gt;</strong>
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groovy&gt;</strong>request.lineItems.any { i -&gt; i.value &gt; 100 }<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groovy&gt;</strong>
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"queue:bar"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/filter&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_scriptcontext"></a>ScriptContext</h2></div></div></div><p>The JSR-223 scripting languages ScriptContext is pre configured with the
following attributes all set at <code class="literal">ENGINE_SCOPE</code>:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Type</th><th align="left" valign="top">Value</th></tr></thead><tbody><tr><td align="left" valign="top"><p>context</p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.CamelContext</code></p></td><td align="left" valign="top"><p>The Camel Context ( It cannot be used in groovy)</p></td></tr><tr><td align="left" valign="top"><p>camelContext</p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.CamelContext</code></p></td><td align="left" valign="top"><p>The Camel Context</p></td></tr><tr><td align="left" valign="top"><p>exchange</p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.Exchange</code></p></td><td align="left" valign="top"><p>The current Exchange</p></td></tr><tr><td align="left" valign="top"><p>request</p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.Message</code></p></td><td align="left" valign="top"><p>The message (IN message)</p></td></tr><tr><td align="left" valign="top"><p>response</p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.Message</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Deprecated</strong></span>: The OUT message. The OUT message if null by default. Use
IN message instead.</p></td></tr><tr><td align="left" valign="top"><p>properties</p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.builder.script.PropertiesFunction</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.9:</strong></span> Function with a <code class="literal">resolve</code> method to make it easier to use
Camels <a class="link" href="properties-component.html" title="Properties Component">Properties</a> component from scripts. See
further below for example.</p></td></tr></tbody></table></div><p>See Scripting Languages for the list of
languages with explicit DSL support.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_additional_arguments_to_scriptingengine"></a>Additional arguments to ScriptingEngine</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.8</strong></span></p><p>You can provide additional arguments to the <code class="literal">ScriptingEngine</code> using a
header on the Camel message with the key <code class="literal">CamelScriptArguments</code>.
 See this example:</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_properties_function"></a>Using properties function</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.9</strong></span></p><p>If you need to use the <a class="link" href="properties-component.html" title="Properties Component">Properties</a> component from a
script to lookup property placeholders, then its a bit cumbersome to do
so.
For example to set a header name myHeader with a value from a property
placeholder, which key is provided in a header named "foo".</p><pre class="programlisting">.setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"myHeader"</em></strong>).groovy(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">""</em></strong>context.resolvePropertyPlaceholders( + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">'{{'</em></strong> + request.headers.get(&amp;#<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">39</span>;foo&amp;#<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">39</span>;) + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">'}}'</em></strong> + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">")"</em></strong>)</pre><p>From Camel 2.9 onwards you can now use the properties function and the
same example is simpler:</p><pre class="programlisting">.setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"myHeader"</em></strong>).groovy(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"properties.resolve(request.headers.get(&amp;#39;foo&amp;#39;))"</em></strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_loading_script_from_external_resource"></a>Loading script from external resource</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.11</strong></span></p><p>You can externalize the script and have Camel load it from a resource
such as <code class="literal">"classpath:"</code>, <code class="literal">"file:"</code>, or <code class="literal">"http:"</code>.
 This is done using the following syntax: <code class="literal">"resource:scheme:location"</code>,
eg to refer to a file on the classpath you can do:</p><pre class="programlisting">.setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"myHeader"</em></strong>).groovy(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"resource:classpath:mygroovy.groovy"</em></strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_how_to_get_the_result_from_multiple_statements_script"></a>How to get the result from multiple statements script</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.14</strong></span></p><p>As the scripteengine evale method just return a Null if it runs a
multiple statments script. Camel now look up the value of script result
by using the key of "result" from the value set. If you have multiple
statements script, you need to make sure you set the value of result
variable as the script return value.</p><pre class="programlisting">bar = "baz";
# some other statements ...
# camel take the result value as the script evaluation result
result = body * 2 + 1</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dependencies_35"></a>Dependencies</h2></div></div></div><p>To use scripting languages in your camel routes you need to add the a
dependency on <span class="strong"><strong>camel-script</strong></span> which integrates the JSR-223 scripting
engine.</p><p>If you use maven you could just add the following to your pom.xml,
substituting the version number for the latest &amp; greatest release (see
the download page for the latest versions).</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-script<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div></div></body></html>