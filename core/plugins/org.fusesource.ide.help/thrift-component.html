<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Thrift Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="test-component.html" title="Test Component"><link rel="next" href="thrift-dataformat.html" title="Thrift DataFormat"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="thrift-component"></a>Thrift Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="thrift-component.html#_uri_format_198">URI format</a></span></dt><dt><span class="section"><a href="thrift-component.html#_endpoint_options_21">Endpoint Options</a></span></dt><dt><span class="section"><a href="thrift-component.html#_thrift_method_parameters_mapping">Thrift method parameters mapping</a></span></dt><dt><span class="section"><a href="thrift-component.html#_thrift_consumer_headers_will_be_installed_after_the_consumer_invocation">Thrift consumer headers (will be installed after the consumer invocation)</a></span></dt><dt><span class="section"><a href="thrift-component.html#_examples_35">Examples</a></span></dt><dt><span class="section"><a href="thrift-component.html#_for_more_information_see_these_resources_4">For more information, see these resources</a></span></dt><dt><span class="section"><a href="thrift-component.html#_see_also_137">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.20</strong></span></p><p>The Thrift component allows you to call or expose Remote Procedure Call (RPC) services
using <a class="link" href="https://thrift.apache.org/" target="_top">Apache Thrift</a> binary communication protocol and serialization mechanism.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-thrift<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_198"></a>URI format</h2></div></div></div><pre class="programlisting">thrift:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//service[?options]</em></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_endpoint_options_21"></a>Endpoint Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="thrift-component.html#_path_parameters_3_parameters_18">Path Parameters (3 parameters):</a></span></dt><dt><span class="section"><a href="thrift-component.html#_query_parameters_12_parameters_8">Query Parameters (12 parameters):</a></span></dt></dl></div><p>The Thrift component supports 2 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>useGlobalSslContext Parameters</strong></span> (security)</p></td><td align="left" valign="top"><p>Determine if the thrift component is using global SSL context parameters</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Thrift endpoint is configured using URI syntax:</p><pre class="screen">thrift:host:port/service</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_3_parameters_18"></a>Path Parameters (3 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>host</strong></span></p></td><td align="left" valign="top"><p>The Thrift server host name. This is localhost or 0.0.0.0 (if not defined) when being a consumer or remote server host name when using producer.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>port</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The Thrift server port</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>service</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Fully qualified service name from the thrift descriptor file (package dot service definition name)</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_12_parameters_8"></a>Query Parameters (12 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>compressionType</strong></span> (common)</p></td><td align="left" valign="top"><p>Protocol compression mechanism type</p></td><td align="center" valign="top"><p>NONE</p></td><td align="left" valign="top"><p>ThriftCompressionType</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangeProtocol</strong></span> (common)</p></td><td align="left" valign="top"><p>Exchange protocol serialization type</p></td><td align="center" valign="top"><p>BINARY</p></td><td align="left" valign="top"><p>ThriftExchangeProtocol</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>clientTimeout</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Client timeout for consumers</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maxPoolSize</strong></span> (consumer)</p></td><td align="left" valign="top"><p>The Thrift server consumer max thread pool size</p></td><td align="center" valign="top"><p>10</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>poolSize</strong></span> (consumer)</p></td><td align="left" valign="top"><p>The Thrift server consumer initial thread pool size</p></td><td align="center" valign="top"><p>1</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>method</strong></span> (producer)</p></td><td align="left" valign="top"><p>The Thrift invoked method name</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>negotiationType</strong></span> (security)</p></td><td align="left" valign="top"><p>Security negotiation type</p></td><td align="center" valign="top"><p>PLAINTEXT</p></td><td align="left" valign="top"><p>ThriftNegotiationType</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sslParameters</strong></span> (security)</p></td><td align="left" valign="top"><p>Configuration parameters for SSL/TLS security negotiation</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>SSLContextParameters</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_thrift_method_parameters_mapping"></a>Thrift method parameters mapping</h2></div></div></div><p>Parameters in the called procedure must be passed as a list of objects inside the message body. The primitives are converted from the objects on the fly.
In order to correctly find the corresponding method, all types must be transmitted regardless of the values. Please see an exmaple below, how to pass
different parameters to the method with the Camel body</p><pre class="programlisting">List requestBody = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ArrayList();

requestBody.add((<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">boolean</strong>)true);
requestBody.add((<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">byte</strong>)THRIFT_TEST_NUM1);
requestBody.add((<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">short</strong>)THRIFT_TEST_NUM1);
requestBody.add((<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">int</strong>)THRIFT_TEST_NUM1);
requestBody.add((<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">long</strong>)THRIFT_TEST_NUM1);
requestBody.add((<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">double</strong>)THRIFT_TEST_NUM1);
requestBody.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"empty"</em></strong>); <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// String parameter</em>
requestBody.add(ByteBuffer.allocate(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">10</span>)); <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// binary parameter</em>
requestBody.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Work(THRIFT_TEST_NUM1, THRIFT_TEST_NUM2, Operation.MULTIPLY)); <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Struct parameter</em>
requestBody.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ArrayList&lt;Integer&gt;()); <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// list paramater</em>
requestBody.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> HashSet&lt;String&gt;()); <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// set parameter</em>
requestBody.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> HashMap&lt;String, Long&gt;()); <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// map parameter</em>

Object responseBody = template.requestBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:thrift-alltypes"</em></strong>, requestBody);</pre><p>Incoming parameters in the service consumer will also be passed to the message body as a list of objects.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_thrift_consumer_headers_will_be_installed_after_the_consumer_invocation"></a>Thrift consumer headers (will be installed after the consumer invocation)</h2></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="24%" class="col_1"><col width="51%" class="col_2"><col width="25%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Header name</th><th align="left" valign="top">Description</th><th align="left" valign="top">Possible values</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>CamelThriftMethodName</strong></span></p></td><td align="left" valign="top"><p>Method name handled by the consumer service</p></td><td align="left" valign="top">&nbsp;</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_examples_35"></a>Examples</h2></div></div></div><p>Below is a simple synchronous method invoke with host and port parameters</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:thrift-calculate"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"thrift://localhost:1101/org.apache.camel.component.thrift.generated.Calculator?method=calculate&amp;synchronous=true"</em></strong>);</pre><p>Below is a simple synchronous method invoke for the XML DSL configuration</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:thrift-add"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096"> /&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"thrift://localhost:1101/org.apache.camel.component.thrift.generated.Calculator?method=add&amp;synchronous=true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>Thrift service consumer with asynchronous communication</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"thrift://localhost:1101/org.apache.camel.component.thrift.generated.Calculator"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:thrift-service"</em></strong>);</pre><p>It&#8217;s possible to automate Java code generation for .thrift files using <span class="strong"><strong>thrift-maven-plugin</strong></span>, but before start the thrift compiler binary distribution for your operating system must be present on the running host.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_for_more_information_see_these_resources_4"></a>For more information, see these resources</h2></div></div></div><p><a class="link" href="https://github.com/apache/thrift/" target="_top">Thrift project GitHub</a>
<a class="link" href="https://thrift.apache.org/tutorial/java" target="_top">https://thrift.apache.org/tutorial/java</a> [Apache Thrift Java tutorial]</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_137"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Getting Started</li><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li></ul></div></div></div></body></html>