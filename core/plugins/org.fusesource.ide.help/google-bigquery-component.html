<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Google BigQuery Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="github-component.html" title="GitHub Component"><link rel="next" href="google-calendar-component.html" title="Google Calendar Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="google-bigquery-component"></a>Google BigQuery Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="google-bigquery-component.html#_component_description">Component Description</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#GoogleBigQuery-AuthenticationConfiguration">Authentication Configuration</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_uri_format_81">URI Format</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_options_46">Options</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_message_headers_13">Message Headers</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_producer_endpoints_5">Producer Endpoints</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_template_tables">Template tables</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_partitioning">Partitioning</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_ensuring_data_consistency">Ensuring data consistency</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.20</strong></span></p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_component_description"></a>Component Description</h2></div></div></div><p>The Google Bigquery component provides access
to <a class="link" href="https://cloud.google.com/bigquery/" target="_top">Cloud BigQuery Infrastructure</a>&nbsp;via
the <a class="link" href="https://developers.google.com/api-client-library/java/apis/bigquery/v2" target="_top">Google Client Services API</a>.</p><p>The current implementation does not use gRPC.</p><p>The current implementation does not support querying BigQuery i.e. is a producer only.</p><p>Maven users will need to add the following dependency to their pom.xml
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-google-bigquery<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="GoogleBigQuery-AuthenticationConfiguration"></a>Authentication Configuration</h2></div></div></div><p>Google BigQuery component authentication is targeted for use with the GCP Service Accounts.
For more information please refer to <a class="link" href="https://cloud.google.com/docs/authentication" target="_top">Google Cloud Platform Auth Guide</a></p><p>Google security credentials can be set explicitly via one of the two options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Service Account Email and Service Account Key (PEM format)</li><li class="listitem">GCP credentials file location</li></ul></div><p>If both are set, the Service Account Email/Key will take precedence.</p><p>Or implicitly, where the connection factory falls back on
<a class="link" href="https://developers.google.com/identity/protocols/application-default-credentials#howtheywork" target="_top">Application Default Credentials</a>.</p><p><span class="strong"><strong>OBS!</strong></span> The location of the default credentials file is configurable - via GOOGLE_APPLICATION_CREDENTIALS environment variable.</p><p>Service Account Email and Service Account Key can be found in the GCP JSON credentials file as client_email and private_key respectively.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_81"></a>URI Format</h2></div></div></div><pre class="programlisting">        google-bigquery:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//project-id:datasetId[:tableId]?[options]</em></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_46"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="google-bigquery-component.html#_path_parameters_3_parameters_5">Path Parameters (3 parameters):</a></span></dt><dt><span class="section"><a href="google-bigquery-component.html#_query_parameters_3_parameters_2">Query Parameters (3 parameters):</a></span></dt></dl></div><p>The Google BigQuery component supports 4 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>projectId</strong></span> (producer)</p></td><td align="left" valign="top"><p>Google Cloud Project Id</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>datasetId</strong></span> (producer)</p></td><td align="left" valign="top"><p>BigQuery Dataset Id</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>connectionFactory</strong></span> (producer)</p></td><td align="left" valign="top"><p>ConnectionFactory to obtain connection to Bigquery Service. If non provided the default one will be used</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GoogleBigQuery ConnectionFactory</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Google BigQuery endpoint is configured using URI syntax:</p><pre class="screen">google-bigquery:projectId:datasetId:tableName</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_3_parameters_5"></a>Path Parameters (3 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>projectId</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Google Cloud Project Id</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>datasetId</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> BigQuery Dataset Id</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>tableId</strong></span></p></td><td align="left" valign="top"><p>BigQuery table id</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_3_parameters_2"></a>Query Parameters (3 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>connectionFactory</strong></span> (producer)</p></td><td align="left" valign="top"><p>ConnectionFactory to obtain connection to Bigquery Service. If non provided the default will be used.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GoogleBigQuery ConnectionFactory</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useAsInsertId</strong></span> (producer)</p></td><td align="left" valign="top"><p>Field name to use as insert id</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_headers_13"></a>Message Headers</h2></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelGoogleBigQuery.TableSuffix</code></p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Table suffix to use when inserting data</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelGoogleBigQuery.InsertId</code></p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>InsertId to use when inserting data</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelGoogleBigQuery.PartitionDecorator</code></p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Partition decorator to indicate partition to use when inserting data</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelGoogleBigQuery.TableId</code></p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Table id where data will be submitted. If specified will override endpoint configuration</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_producer_endpoints_5"></a>Producer Endpoints</h2></div></div></div><p>Producer endpoints can accept and deliver to BigQuery individual and grouped
exchanges alike. Grouped exchanges have <code class="literal">Exchange.GROUPED_EXCHANGE</code> property set.</p><p>Goole BigQuery producer will send a grouped exchange in a single api call unless different table suffix or
partition decorators are specified in which case it will break it down to ensure data is written with the
correct suffix or partition decorator.</p><p>Google BigQuery endpoint expects the payload to be either a map or list of maps. A payload containing a map
will insert a single row and a payload containing a list of map&#8217;s will insert a row for each entry in the list.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_template_tables"></a>Template tables</h2></div></div></div><p>Reference: <a class="link" href="https://cloud.google.com/bigquery/streaming-data-into-bigquery#template-tables" target="_top">https://cloud.google.com/bigquery/streaming-data-into-bigquery#template-tables</a></p><p>Templated tables can be specified using the <code class="literal">GoogleBigQueryConstants.TABLE_SUFFIX</code> header.</p><p>I.e. the following route will create tables and insert records sharded on a per day basis:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
.header(GoogleBigQueryConstants.TABLE_SUFFIX, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"_${date:now:yyyyMMdd}"</em></strong>)
.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"google-bigquery:sampleDataset:sampleTable"</em></strong>)</pre><p>Note it is recommended to use partitioning for this use case.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_partitioning"></a>Partitioning</h2></div></div></div><p>Reference: <a class="link" href="https://cloud.google.com/bigquery/docs/creating-partitioned-tables" target="_top">https://cloud.google.com/bigquery/docs/creating-partitioned-tables</a></p><p>Partitioning is specified when creating a table and if set data will be automatically partitioned into
separate tables. When inserting data a specific partition can be specified by setting the
<code class="literal">GoogleBigQueryConstants.PARTITION_DECORATOR</code> header on the exchange.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_ensuring_data_consistency"></a>Ensuring data consistency</h2></div></div></div><p>Reference: <a class="link" href="https://cloud.google.com/bigquery/streaming-data-into-bigquery#dataconsistency" target="_top">https://cloud.google.com/bigquery/streaming-data-into-bigquery#dataconsistency</a></p><p>A insert id can be set on the exchange with the header <code class="literal">GoogleBigQueryConstants.INSERT_ID</code> or by specifying
query parameter <code class="literal">useAsInsertId</code>. As an insert id need to be specified per row inserted the exchange header can&#8217;t
be used when the payload is a list - if the payload is a list the <code class="literal">GoogleBigQueryConstants.INSERT_ID</code> will
be ignored. In that case use the query parameter <code class="literal">useAsInsertId</code>.</p></div></div></body></html>