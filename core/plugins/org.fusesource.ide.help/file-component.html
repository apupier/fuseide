<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>File Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="facebook-component.html" title="Facebook Component"><link rel="next" href="file-language.html" title="File Language"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="file-component"></a>File Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="file-component.html#_uri_format_72">URI format</a></span></dt><dt><span class="section"><a href="file-component.html#_uri_options_23">URI Options</a></span></dt><dt><span class="section"><a href="file-component.html#_move_and_delete_operations">Move and Delete operations</a></span></dt><dt><span class="section"><a href="file-component.html#_fine_grained_control_over_move_and_premove_option">Fine grained control over Move and PreMove option</a></span></dt><dt><span class="section"><a href="file-component.html#_about_movefailed">About moveFailed</a></span></dt><dt><span class="section"><a href="file-component.html#_message_headers_8">Message Headers</a></span></dt><dt><span class="section"><a href="file-component.html#_batch_consumer_5">Batch Consumer</a></span></dt><dt><span class="section"><a href="file-component.html#_exchange_properties_file_consumer_only">Exchange Properties, file consumer only</a></span></dt><dt><span class="section"><a href="file-component.html#_using_charset">Using charset</a></span></dt><dt><span class="section"><a href="file-component.html#_common_gotchas_with_folder_and_filenames">Common gotchas with folder and filenames</a></span></dt><dt><span class="section"><a href="file-component.html#_filename_expression">Filename Expression</a></span></dt><dt><span class="section"><a href="file-component.html#_consuming_files_from_folders_where_others_drop_files_directly">Consuming files from folders where others drop files directly</a></span></dt><dt><span class="section"><a href="file-component.html#_using_done_files">Using done files</a></span></dt><dt><span class="section"><a href="file-component.html#_writing_done_files">Writing done files</a></span></dt><dt><span class="section"><a href="file-component.html#_samples_15">Samples</a></span></dt><dt><span class="section"><a href="file-component.html#File2-Usingflatten">Using flatten</a></span></dt><dt><span class="section"><a href="file-component.html#_reading_from_a_directory_and_the_default_move_operation">Reading from a directory and the default move operation</a></span></dt><dt><span class="section"><a href="file-component.html#_read_from_a_directory_and_process_the_message_in_java">Read from a directory and process the message in java</a></span></dt><dt><span class="section"><a href="file-component.html#_writing_to_files">Writing to files</a></span></dt><dt><span class="section"><a href="file-component.html#_using_expression_for_filenames">Using expression for filenames</a></span></dt><dt><span class="section"><a href="file-component.html#_avoiding_reading_the_same_file_more_than_once_idempotent_consumer">Avoiding reading the same file more than once (idempotent consumer)</a></span></dt><dt><span class="section"><a href="file-component.html#_using_a_file_based_idempotent_repository">Using a file based idempotent repository</a></span></dt><dt><span class="section"><a href="file-component.html#_using_a_jpa_based_idempotent_repository">Using a JPA based idempotent repository</a></span></dt><dt><span class="section"><a href="file-component.html#_filter_using_org_apache_camel_component_file_genericfilefilter">Filter using org.apache.camel.component.file.GenericFileFilter</a></span></dt><dt><span class="section"><a href="file-component.html#_filtering_using_ant_path_matcher">Filtering using ANT path matcher</a></span></dt><dt><span class="section"><a href="file-component.html#_using_genericfileprocessstrategy">Using GenericFileProcessStrategy</a></span></dt><dt><span class="section"><a href="file-component.html#_using_filter">Using filter</a></span></dt><dt><span class="section"><a href="file-component.html#_using_consumer_bridgeerrorhandler">Using consumer.bridgeErrorHandler</a></span></dt><dt><span class="section"><a href="file-component.html#_debug_logging">Debug logging</a></span></dt><dt><span class="section"><a href="file-component.html#_see_also_45">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 1.0</strong></span></p><p>The File component provides access to file systems, allowing files to be
processed by any other Camel Components or
messages from other components to be saved to disk.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_72"></a>URI format</h2></div></div></div><pre class="screen">file:directoryName[?options]</pre><p>or</p><pre class="screen">file://directoryName[?options]</pre><p>Where <span class="strong"><strong>directoryName</strong></span> represents the underlying file directory.</p><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p><p><span class="strong"><strong>Only directories</strong></span></p><p>Camel supports only endpoints configured with a starting directory. So
the <span class="strong"><strong>directoryName</strong></span> must be a directory.
 If you want to consume a single file only, you can use the <span class="strong"><strong>fileName</strong></span>
option, e.g. by setting <code class="literal">fileName=thefilename</code>.
 Also, the starting directory must not contain dynamic expressions with
$\{ } placeholders. Again use the <code class="literal">fileName</code> option to specify the
dynamic part of the filename.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="imagesdb/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Avoid reading files currently being written by another
application</strong></span> Beware the JDK File IO API is a bit limited in detecting whether another
application is currently writing/copying a file. And the implementation
can be different depending on OS platform as well. This could lead to
that Camel thinks the file is not locked by another process and start
consuming it. Therefore you have to do you own investigation what suites
your environment. To help with this Camel provides different <code class="literal">readLock</code>
options and <code class="literal">doneFileName</code> option that you can use. See also the section
<span class="emphasis"><em>Consuming files from folders where others drop files directly</em></span>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_options_23"></a>URI Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="file-component.html#_path_parameters_1_parameters_61">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="file-component.html#_query_parameters_81_parameters">Query Parameters (81 parameters):</a></span></dt></dl></div><p>The File component has no options.</p><p>The File endpoint is configured using URI syntax:</p><pre class="screen">file:directoryName</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_61"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>directoryName</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The starting directory</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>File</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_81_parameters"></a>Query Parameters (81 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>charset</strong></span> (common)</p></td><td align="left" valign="top"><p>This option is used to specify the encoding of the file. You can use this on the consumer, to specify the encodings of the files, which allow Camel to know the charset it should load the file content in case the file content is being accessed. Likewise when writing a file, you can use this option to specify which charset to write the file as well. Do mind that when writing the file Camel may have to read the message content into memory to be able to convert the data into the configured charset, so do not use this if you have big messages.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>doneFileName</strong></span> (common)</p></td><td align="left" valign="top"><p>Producer: If provided, then Camel will write a 2nd done file when the original file has been written. The done file will be empty. This option configures what file name to use. Either you can specify a fixed name. Or you can use dynamic placeholders. The done file will always be written in the same folder as the original file. Consumer: If provided, Camel will only consume files if a done file exists. This option configures what file name to use. Either you can specify a fixed name. Or you can use dynamic placeholders.The done file is always expected in the same folder as the original file. Only $file.name and $file.name.noext is supported as dynamic placeholders.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>fileName</strong></span> (common)</p></td><td align="left" valign="top"><p>Use Expression such as File Language to dynamically set the filename. For consumers, it&#8217;s used as a filename filter. For producers, it&#8217;s used to evaluate the filename to write. If an expression is set, it take precedence over the CamelFileName header. (Note: The header itself can also be an Expression). The expression options support both String and Expression types. If the expression is a String type, it is always evaluated using the File Language. If the expression is an Expression type, the specified Expression type is used - this allows you, for instance, to use OGNL expressions. For the consumer, you can use it to filter filenames, so you can for instance consume today&#8217;s file using the File Language syntax: mydata-$date:now:yyyyMMdd.txt. The producers support the CamelOverruleFileName header which takes precedence over any existing CamelFileName header; the CamelOverruleFileName is a header that is used only once, and makes it easier as this avoids to temporary store CamelFileName and have to restore it afterwards.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN/ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>delete</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If true, the file will be deleted after it is processed successfully.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>moveFailed</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the move failure expression based on Simple language. For example, to move files into a .error subdirectory use: .error. Note: When moving the files to the fail location Camel will handle the error and will not pick up the file again.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>noop</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If true, the file is not moved or deleted in any way. This option is good for readonly data, or for ETL type requirements. If noop=true, Camel will set idempotent=true as well, to avoid consuming the same files over and over again.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>preMove</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Expression (such as File Language) used to dynamically set the filename when moving it before processing. For example to move in-progress files into the order directory set this value to order.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>preSort</strong></span> (consumer)</p></td><td align="left" valign="top"><p>When pre-sort is enabled then the consumer will sort the file and directory names during polling, that was retrieved from the file system. You may want to do this in case you need to operate on the files in a sorted order. The pre-sort is executed before the consumer starts to filter, and accept files to process by Camel. This option is default=false meaning disabled.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>recursive</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If a directory, will look for files in all the sub-directories as well.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sendEmptyMessageWhenIdle</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>directoryMustExist</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Similar to startingDirectoryMustExist but this applies during polling recursive sub directories.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN/ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the default exchange pattern when creating an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>extendedAttributes</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To define which file attributes of interest. Like posix:permissions,posix:owner,basic:lastAccessTime, it supports basic wildcard like posix:, basic:lastAccessTime</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>inProgressRepository</strong></span> (consumer)</p></td><td align="left" valign="top"><p>A pluggable in-progress repository org.apache.camel.spi.IdempotentRepository. The in-progress repository is used to account the current in progress files being consumed. By default a memory based repository is used.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>localWorkDirectory</strong></span> (consumer)</p></td><td align="left" valign="top"><p>When consuming, a local work directory can be used to store the remote file content directly in local files, to avoid loading the content into memory. This is beneficial, if you consume a very big remote file and thus can conserve memory.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>onCompletionException Handler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To use a custom org.apache.camel.spi.ExceptionHandler to handle any thrown exceptions that happens during the file on completion process where the consumer does either a commit or rollback. The default implementation will log any exception at WARN level and ignore.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>pollStrategy</strong></span> (consumer)</p></td><td align="left" valign="top"><p>A pluggable org.apache.camel.PollingConsumerPollingStrategy allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel. In other words the error occurred while the polling was gathering information, for instance access to a file network failed so Camel cannot access it to scan for files. The default implementation will log the caused exception at WARN level and ignore it.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>PollingConsumerPoll Strategy</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>probeContentType</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Whether to enable probing of the content type. If enable then the consumer uses link FilesprobeContentType(java.nio.file.Path) to determine the content-type of the file, and store that as a header with key link ExchangeFILE_CONTENT_TYPE on the Message.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>processStrategy</strong></span> (consumer)</p></td><td align="left" valign="top"><p>A pluggable org.apache.camel.component.file.GenericFileProcessStrategy allowing you to implement your own readLock option or similar. Can also be used when special conditions must be met before a file can be consumed, such as a special ready file exists. If this option is set then the readLock option does not apply.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GenericFileProcess Strategy&lt;T&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>startingDirectoryMustExist</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Whether the starting directory must exist. Mind that the autoCreate option is default enabled, which means the starting directory is normally auto created if it doesn&#8217;t exist. You can disable autoCreate and enable this to ensure the starting directory must exist. Will thrown an exception if the directory doesn&#8217;t exist.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>fileExist</strong></span> (producer)</p></td><td align="left" valign="top"><p>What to do if a file already exists with the same name. Override, which is the default, replaces the existing file. Append - adds content to the existing file. Fail - throws a GenericFileOperationException, indicating that there is already an existing file. Ignore - silently ignores the problem and does not override the existing file, but assumes everything is okay. Move - option requires to use the moveExisting option to be configured as well. The option eagerDeleteTargetFile can be used to control what to do if an moving the file, and there exists already an existing file, otherwise causing the move operation to fail. The Move option will move any existing files, before writing the target file. TryRename is only applicable if tempFileName option is in use. This allows to try renaming the file from the temporary name to the actual name, without doing any exists check. This check may be faster on some file systems and especially FTP servers.</p></td><td align="center" valign="top"><p>Override</p></td><td align="left" valign="top"><p>GenericFileExist</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>flatten</strong></span> (producer)</p></td><td align="left" valign="top"><p>Flatten is used to flatten the file name path to strip any leading paths, so it&#8217;s just the file name. This allows you to consume recursively into sub-directories, but when you eg write the files to another directory they will be written in a single directory. Setting this to true on the producer enforces that any file name in CamelFileName header will be stripped for any leading paths.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>moveExisting</strong></span> (producer)</p></td><td align="left" valign="top"><p>Expression (such as File Language) used to compute file name to use when fileExist=Move is configured. To move files into a backup subdirectory just enter backup. This option only supports the following File Language tokens: file:name, file:name.ext, file:name.noext, file:onlyname, file:onlyname.noext, file:ext, and file:parent. Notice the file:parent is not supported by the FTP component, as the FTP component can only move any existing files to a relative directory based on current dir as base.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>tempFileName</strong></span> (producer)</p></td><td align="left" valign="top"><p>The same as tempPrefix option but offering a more fine grained control on the naming of the temporary filename as it uses the File Language.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>tempPrefix</strong></span> (producer)</p></td><td align="left" valign="top"><p>This option is used to write the file using a temporary name and then, after the write is complete, rename it to the real name. Can be used to identify files being written and also avoid consumers (not using exclusive read locks) reading in progress files. Is often used by FTP when uploading big files.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>allowNullBody</strong></span> (producer)</p></td><td align="left" valign="top"><p>Used to specify if a null body is allowed during file writing. If set to true then an empty file will be created, when set to false, and attempting to send a null body to the file component, a GenericFileWriteException of 'Cannot write null body to file.' will be thrown. If the fileExist option is set to 'Override', then the file will be truncated, and if set to append the file will remain unchanged.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>chmod</strong></span> (producer)</p></td><td align="left" valign="top"><p>Specify the file permissions which is sent by the producer, the chmod value must be between 000 and 777; If there is a leading digit like in 0755 we will ignore it.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>chmodDirectory</strong></span> (producer)</p></td><td align="left" valign="top"><p>Specify the directory permissions used when the producer creates missing directories, the chmod value must be between 000 and 777; If there is a leading digit like in 0755 we will ignore it.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>eagerDeleteTargetFile</strong></span> (producer)</p></td><td align="left" valign="top"><p>Whether or not to eagerly delete any existing target file. This option only applies when you use fileExists=Override and the tempFileName option as well. You can use this to disable (set it to false) deleting the target file before the temp file is written. For example you may write big files and want the target file to exists during the temp file is being written. This ensure the target file is only deleted until the very last moment, just before the temp file is being renamed to the target filename. This option is also used to control whether to delete any existing files when fileExist=Move is enabled, and an existing file exists. If this option copyAndDeleteOnRenameFails false, then an exception will be thrown if an existing file existed, if its true, then the existing file is deleted before the move operation.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>forceWrites</strong></span> (producer)</p></td><td align="left" valign="top"><p>Whether to force syncing writes to the file system. You can turn this off if you do not want this level of guarantee, for example if writing to logs / audit logs etc; this would yield better performance.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>keepLastModified</strong></span> (producer)</p></td><td align="left" valign="top"><p>Will keep the last modified timestamp from the source file (if any). Will use the Exchange.FILE_LAST_MODIFIED header to located the timestamp. This header can contain either a java.util.Date or long with the timestamp. If the timestamp exists and the option is enabled it will set this timestamp on the written file. Note: This option only applies to the file producer. You cannot use this option with any of the ftp producers.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>autoCreate</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Automatically create missing directories in the file&#8217;s pathname. For the file consumer, that means creating the starting directory. For the file producer, it means the directory the files should be written to.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bufferSize</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Write buffer sized in bytes.</p></td><td align="center" valign="top"><p>131072</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>copyAndDeleteOnRenameFail</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether to fallback and do a copy and delete file, in case the file could not be renamed directly. This option is not available for the FTP component.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>renameUsingCopy</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Perform rename operations using a copy and delete strategy. This is primarily used in environments where the regular rename operation is unreliable (e.g. across different file systems or networks). This option takes precedence over the copyAndDeleteOnRenameFail parameter that will automatically fall back to the copy and delete strategy, but only after additional delays.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>antExclude</strong></span> (filter)</p></td><td align="left" valign="top"><p>Ant style filter exclusion. If both antInclude and antExclude are used, antExclude takes precedence over antInclude. Multiple exclusions may be specified in comma-delimited format.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>antFilterCaseSensitive</strong></span> (filter)</p></td><td align="left" valign="top"><p>Sets case sensitive flag on ant filter</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>antInclude</strong></span> (filter)</p></td><td align="left" valign="top"><p>Ant style filter inclusion. Multiple inclusions may be specified in comma-delimited format.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>eagerMaxMessagesPerPoll</strong></span> (filter)</p></td><td align="left" valign="top"><p>Allows for controlling whether the limit from maxMessagesPerPoll is eager or not. If eager then the limit is during the scanning of files. Where as false would scan all files, and then perform sorting. Setting this option to false allows for sorting all files first, and then limit the poll. Mind that this requires a higher memory usage as all file details are in memory to perform the sorting.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exclude</strong></span> (filter)</p></td><td align="left" valign="top"><p>Is used to exclude files, if filename matches the regex pattern (matching is case in-senstive). Notice if you use symbols such as plus sign and others you would need to configure this using the RAW() syntax if configuring this as an endpoint uri. See more details at configuring endpoint uris</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>filter</strong></span> (filter)</p></td><td align="left" valign="top"><p>Pluggable filter as a org.apache.camel.component.file.GenericFileFilter class. Will skip files if filter returns false in its accept() method.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GenericFileFilter&lt;T&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>filterDirectory</strong></span> (filter)</p></td><td align="left" valign="top"><p>Filters the directory based on Simple language. For example to filter on current date, you can use a simple date pattern such as $date:now:yyyMMdd</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>filterFile</strong></span> (filter)</p></td><td align="left" valign="top"><p>Filters the file based on Simple language. For example to filter on file size, you can use $file:size 5000</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>idempotent</strong></span> (filter)</p></td><td align="left" valign="top"><p>Option to use the Idempotent Consumer EIP pattern to let Camel skip already processed files. Will by default use a memory based LRUCache that holds 1000 entries. If noop=true then idempotent will be enabled as well to avoid consuming the same files over and over again.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>Boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>idempotentKey</strong></span> (filter)</p></td><td align="left" valign="top"><p>To use a custom idempotent key. By default the absolute path of the file is used. You can use the File Language, for example to use the file name and file size, you can do: idempotentKey=$file:name-$file:size</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>idempotentRepository</strong></span> (filter)</p></td><td align="left" valign="top"><p>A pluggable repository org.apache.camel.spi.IdempotentRepository which by default use MemoryMessageIdRepository if none is specified and idempotent is true.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>include</strong></span> (filter)</p></td><td align="left" valign="top"><p>Is used to include files, if filename matches the regex pattern (matching is case in-sensitive). Notice if you use symbols such as plus sign and others you would need to configure this using the RAW() syntax if configuring this as an endpoint uri. See more details at configuring endpoint uris</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maxDepth</strong></span> (filter)</p></td><td align="left" valign="top"><p>The maximum depth to traverse when recursively processing a directory.</p></td><td align="center" valign="top"><p>2147483647</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maxMessagesPerPoll</strong></span> (filter)</p></td><td align="left" valign="top"><p>To define a maximum messages to gather per poll. By default no maximum is set. Can be used to set a limit of e.g. 1000 to avoid when starting up the server that there are thousands of files. Set a value of 0 or negative to disabled it. Notice: If this option is in use then the File and FTP components will limit before any sorting. For example if you have 100000 files and use maxMessagesPerPoll=500, then only the first 500 files will be picked up, and then sorted. You can use the eagerMaxMessagesPerPoll option and set this to false to allow to scan all files first and then sort afterwards.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>minDepth</strong></span> (filter)</p></td><td align="left" valign="top"><p>The minimum depth to start processing when recursively processing a directory. Using minDepth=1 means the base directory. Using minDepth=2 means the first sub directory.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>move</strong></span> (filter)</p></td><td align="left" valign="top"><p>Expression (such as Simple Language) used to dynamically set the filename when moving it after processing. To move files into a .done subdirectory just enter .done.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exclusiveReadLockStrategy</strong></span> (lock)</p></td><td align="left" valign="top"><p>Pluggable read-lock as a org.apache.camel.component.file.GenericFileExclusiveReadLockStrategy implementation.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GenericFileExclusive ReadLockStrategy&lt;T&gt;</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLock</strong></span> (lock)</p></td><td align="left" valign="top"><p>Used by consumer, to only poll the files if it has exclusive read-lock on the file (i.e. the file is not in-progress or being written). Camel will wait until the file lock is granted. This option provides the build in strategies: none - No read lock is in use markerFile - Camel creates a marker file (fileName.camelLock) and then holds a lock on it. This option is not available for the FTP component changed - Changed is using file length/modification timestamp to detect whether the file is currently being copied or not. Will at least use 1 sec to determine this, so this option cannot consume files as fast as the others, but can be more reliable as the JDK IO API cannot always determine whether a file is currently being used by another process. The option readLockCheckInterval can be used to set the check frequency. fileLock - is for using java.nio.channels.FileLock. This option is not avail for the FTP component. This approach should be avoided when accessing a remote file system via a mount/share unless that file system supports distributed file locks. rename - rename is for using a try to rename the file as a test if we can get exclusive read-lock. idempotent - (only for file component) idempotent is for using a idempotentRepository as the read-lock. This allows to use read locks that supports clustering if the idempotent repository implementation supports that. idempotent-changed - (only for file component) idempotent-changed is for using a idempotentRepository and changed as the combined read-lock. This allows to use read locks that supports clustering if the idempotent repository implementation supports that. idempotent-rename - (only for file component) idempotent-rename is for using a idempotentRepository and rename as the combined read-lock. This allows to use read locks that supports clustering if the idempotent repository implementation supports that. Notice: The various read locks is not all suited to work in clustered mode, where concurrent consumers on different nodes is competing for the same files on a shared file system. The markerFile using a close to atomic operation to create the empty marker file, but its not guaranteed to work in a cluster. The fileLock may work better but then the file system need to support distributed file locks, and so on. Using the idempotent read lock can support clustering if the idempotent repository supports clustering, such as Hazelcast Component or Infinispan.</p></td><td align="center" valign="top"><p>none</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockCheckInterval</strong></span> (lock)</p></td><td align="left" valign="top"><p>Interval in millis for the read-lock, if supported by the read lock. This interval is used for sleeping between attempts to acquire the read lock. For example when using the changed read lock, you can set a higher interval period to cater for slow writes. The default of 1 sec. may be too fast if the producer is very slow writing the file. Notice: For FTP the default readLockCheckInterval is 5000. The readLockTimeout value must be higher than readLockCheckInterval, but a rule of thumb is to have a timeout that is at least 2 or more times higher than the readLockCheckInterval. This is needed to ensure that amble time is allowed for the read lock process to try to grab the lock before the timeout was hit.</p></td><td align="center" valign="top"><p>1000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockDeleteOrphanLock Files</strong></span> (lock)</p></td><td align="left" valign="top"><p>Whether or not read lock with marker files should upon startup delete any orphan read lock files, which may have been left on the file system, if Camel was not properly shutdown (such as a JVM crash). If turning this option to false then any orphaned lock file will cause Camel to not attempt to pickup that file, this could also be due another node is concurrently reading files from the same shared directory.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockLoggingLevel</strong></span> (lock)</p></td><td align="left" valign="top"><p>Logging level used when a read lock could not be acquired. By default a WARN is logged. You can change this level, for example to OFF to not have any logging. This option is only applicable for readLock of types: changed, fileLock, idempotent, idempotent-changed, idempotent-rename, rename.</p></td><td align="center" valign="top"><p>DEBUG</p></td><td align="left" valign="top"><p>LoggingLevel</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockMarkerFile</strong></span> (lock)</p></td><td align="left" valign="top"><p>Whether to use marker file with the changed, rename, or exclusive read lock types. By default a marker file is used as well to guard against other processes picking up the same files. This behavior can be turned off by setting this option to false. For example if you do not want to write marker files to the file systems by the Camel application.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockMinAge</strong></span> (lock)</p></td><td align="left" valign="top"><p>This option applied only for readLock=change. This option allows to specify a minimum age the file must be before attempting to acquire the read lock. For example use readLockMinAge=300s to require the file is at last 5 minutes old. This can speedup the changed read lock as it will only attempt to acquire files which are at least that given age.</p></td><td align="center" valign="top"><p>0</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockMinLength</strong></span> (lock)</p></td><td align="left" valign="top"><p>This option applied only for readLock=changed. This option allows you to configure a minimum file length. By default Camel expects the file to contain data, and thus the default value is 1. You can set this option to zero, to allow consuming zero-length files.</p></td><td align="center" valign="top"><p>1</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockRemoveOnCommit</strong></span> (lock)</p></td><td align="left" valign="top"><p>This option applied only for readLock=idempotent. This option allows to specify whether to remove the file name entry from the idempotent repository when processing the file is succeeded and a commit happens. By default the file is not removed which ensures that any race-condition do not occur so another active node may attempt to grab the file. Instead the idempotent repository may support eviction strategies that you can configure to evict the file name entry after X minutes - this ensures no problems with race conditions.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockRemoveOnRollback</strong></span> (lock)</p></td><td align="left" valign="top"><p>This option applied only for readLock=idempotent. This option allows to specify whether to remove the file name entry from the idempotent repository when processing the file failed and a rollback happens. If this option is false, then the file name entry is confirmed (as if the file did a commit).</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>readLockTimeout</strong></span> (lock)</p></td><td align="left" valign="top"><p>Optional timeout in millis for the read-lock, if supported by the read-lock. If the read-lock could not be granted and the timeout triggered, then Camel will skip the file. At next poll Camel, will try the file again, and this time maybe the read-lock could be granted. Use a value of 0 or lower to indicate forever. Currently fileLock, changed and rename support the timeout. Notice: For FTP the default readLockTimeout value is 20000 instead of 10000. The readLockTimeout value must be higher than readLockCheckInterval, but a rule of thumb is to have a timeout that is at least 2 or more times higher than the readLockCheckInterval. This is needed to ensure that amble time is allowed for the read lock process to try to grab the lock before the timeout was hit.</p></td><td align="center" valign="top"><p>10000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffErrorThreshold</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The number of subsequent error polls (failed due some error) that should happen before the backoffMultipler should kick-in.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffIdleThreshold</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The number of subsequent idle polls that should happen before the backoffMultipler should kick-in.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffMultiplier</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To let the scheduled polling consumer backoff if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then backoffIdleThreshold and/or backoffErrorThreshold must also be configured.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>delay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Milliseconds before the next poll. The default value is 500. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td><td align="center" valign="top"><p>500</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>greedy</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>If greedy is enabled, then the ScheduledPollConsumer will run immediately again, if the previous run polled 1 or more messages.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>initialDelay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Milliseconds before the first poll starts. The default value is 1000. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td><td align="center" valign="top"><p>1000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>runLoggingLevel</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td><td align="center" valign="top"><p>TRACE</p></td><td align="left" valign="top"><p>LoggingLevel</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>scheduledExecutorService</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool. This option allows you to share a thread pool among multiple consumers.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ScheduledExecutor Service</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>scheduler</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Allow to plugin a custom org.apache.camel.spi.ScheduledPollConsumerScheduler to use as the scheduler for firing when the polling consumer runs. The default implementation uses the ScheduledExecutorService and there is a Quartz2, and Spring based which supports CRON expressions. Notice: If using a custom scheduler then the options for initialDelay, useFixedDelay, timeUnit, and scheduledExecutorService may not be in use. Use the text quartz2 to refer to use the Quartz2 scheduler; and use the text spring to use the Spring based; and use the text myScheduler to refer to a custom scheduler by its id in the Registry. See Quartz2 page for an example.</p></td><td align="center" valign="top"><p>none</p></td><td align="left" valign="top"><p>ScheduledPollConsumer Scheduler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>schedulerProperties</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To configure additional properties when using a custom scheduler or any of the Quartz2, Spring based scheduler.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>startScheduler</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Whether the scheduler should be auto started.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>timeUnit</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Time unit for initialDelay and delay options.</p></td><td align="center" valign="top"><p>MILLISECONDS</p></td><td align="left" valign="top"><p>TimeUnit</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useFixedDelay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Controls if fixed delay or fixed rate is used. See ScheduledExecutorService in JDK for details.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>shuffle</strong></span> (sort)</p></td><td align="left" valign="top"><p>To shuffle the list of files (sort in random order)</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sortBy</strong></span> (sort)</p></td><td align="left" valign="top"><p>Built-in sort by using the File Language. Supports nested sorts, so you can have a sort by file name and as a 2nd group sort by modified date.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sorter</strong></span> (sort)</p></td><td align="left" valign="top"><p>Pluggable sorter as a java.util.Comparator class.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>GenericFile&lt;T&gt;&gt;</p></td></tr></tbody></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Default behavior for file producer</strong></span> By default it will override any existing file, if one exist with the same name.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_move_and_delete_operations"></a>Move and Delete operations</h2></div></div></div><p>Any move or delete operations is executed after (post command) the
routing has completed; so during processing of the <code class="literal">Exchange</code> the file
is still located in the inbox folder.</p><p>Lets illustrate this with an example:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inbox?move=.done"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:handleOrder"</em></strong>);</pre><p>When a file is dropped in the <code class="literal">inbox</code> folder, the file consumer notices
this and creates a new <code class="literal">FileExchange</code> that is routed to the
<code class="literal">handleOrder</code> bean. The bean then processes the <code class="literal">File</code> object. At this
point in time the file is still located in the <code class="literal">inbox</code> folder. After the
bean completes, and thus the route is completed, the file consumer will
perform the move operation and move the file to the <code class="literal">.done</code> sub-folder.</p><p>The <span class="strong"><strong>move</strong></span> and the&nbsp;<span class="strong"><strong>preMove</strong></span> options are considered as a directory name
(though if you use an expression such as <a class="link" href="file-language.html" title="File Language">File Language</a>, or <a class="link" href="simple-language.html" title="Simple Language">Simple</a> then the result of the expression
evaluation is the file name to be used - eg if you set</p><pre class="screen">move=../backup/copy-of-${file:name}</pre><p>then that&#8217;s using the <a class="link" href="file-language.html" title="File Language">File Language</a> which we
use return the file name to be used), which can be either relative or
absolute. If relative, the directory is created as a sub-folder from
within the folder where the file was consumed.</p><p>By default, Camel will move consumed files to the <code class="literal">.camel</code> sub-folder
relative to the directory where the file was consumed.</p><p>If you want to delete the file after processing, the route should be:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inobox?delete=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:handleOrder"</em></strong>);</pre><p>We have introduced a <span class="strong"><strong>pre</strong></span> move operation to move files <span class="strong"><strong>before</strong></span> they
are processed. This allows you to mark which files have been scanned as
they are moved to this sub folder before being processed.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inbox?preMove=inprogress"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:handleOrder"</em></strong>);</pre><p>You can combine the <span class="strong"><strong>pre</strong></span> move and the regular move:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inbox?preMove=inprogress&amp;move=.done"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:handleOrder"</em></strong>);</pre><p>So in this situation, the file is in the <code class="literal">inprogress</code> folder when being
processed and after it&#8217;s processed, it&#8217;s moved to the <code class="literal">.done</code> folder.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_fine_grained_control_over_move_and_premove_option"></a>Fine grained control over Move and PreMove option</h2></div></div></div><p>The <span class="strong"><strong>move</strong></span> and <span class="strong"><strong>preMove</strong></span> options
are&nbsp;Expression-based, so we have the full power of
the <a class="link" href="file-language.html" title="File Language">File Language</a> to do advanced configuration
of the directory and name pattern.
 Camel will, in fact, internally convert the directory name you enter
into a <a class="link" href="file-language.html" title="File Language">File Language</a> expression. So when we
enter <code class="literal">move=.done</code> Camel will convert this into:
<code class="literal">${<code class="literal">file:parent</code>}/.done/${``file:onlyname</code>}. This is only done if
Camel detects that you have not provided a $\{ } in the option value
yourself. So when you enter a $\{ } Camel will <span class="strong"><strong>not</strong></span> convert it and thus
you have the full power.</p><p>So if we want to move the file into a backup folder with today&#8217;s date as
the pattern, we can do:</p><pre class="screen">move=backup/${date:now:yyyyMMdd}/${file:name}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_about_movefailed"></a>About moveFailed</h2></div></div></div><p>The <code class="literal">moveFailed</code> option allows you to move files that <span class="strong"><strong>could not</strong></span> be
processed succesfully to another location such as a error folder of your
choice. For example to move the files in an error folder with a
timestamp you can use
<code class="literal">moveFailed=/error/${<code class="literal">file:name.noext</code>}-${date:now:yyyyMMddHHmmssSSS}.${``file:ext</code>}.</p><p>See more examples at <a class="link" href="file-language.html" title="File Language">File Language</a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_headers_8"></a>Message Headers</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="file-component.html#_file_producer_only">File producer only</a></span></dt><dt><span class="section"><a href="file-component.html#_file_consumer_only">File consumer only</a></span></dt></dl></div><p>The following headers are supported by this component:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_file_producer_only"></a>File producer only</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="90%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelFileName</code></p></td><td align="left" valign="top"><p>Specifies the name of the file to write (relative to the endpoint
directory). This name can be a <code class="literal">String</code>; a <code class="literal">String</code> with a
<a class="link" href="file-language.html" title="File Language">File Language</a> or <a class="link" href="simple-language.html" title="Simple Language">Simple</a>
expression; or an Expression object. If it&#8217;s
<code class="literal">null</code> then Camel will auto-generate a filename based on the message
unique ID.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileNameProduced</code></p></td><td align="left" valign="top"><p>The actual absolute filepath (path + name) for the output file that was
written. This header is set by Camel and its purpose is providing
end-users with the name of the file that was written.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelOverruleFileName</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.11:</strong></span> Is used for overruling <code class="literal">CamelFileName</code> header and use the
value instead (but only once, as the producer will remove this header
after writing the file). The value can be only be a String. Notice that
if the option <code class="literal">fileName</code> has been configured, then this is still being
evaluated.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_file_consumer_only"></a>File consumer only</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="90%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelFileName</code></p></td><td align="left" valign="top"><p>Name of the consumed file as a relative file path with offset from the
starting directory configured on the endpoint.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileNameOnly</code></p></td><td align="left" valign="top"><p>Only the file name (the name with no leading paths).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileAbsolute</code></p></td><td align="left" valign="top"><p>A <code class="literal">boolean</code> option specifying whether the consumed file denotes an
absolute path or not. Should normally be <code class="literal">false</code> for relative paths.
Absolute paths should normally not be used but we added to the move
option to allow moving files to absolute paths. But can be used
elsewhere as well.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileAbsolutePath</code></p></td><td align="left" valign="top"><p>The absolute path to the file. For relative files this path holds the
relative path instead.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFilePath</code></p></td><td align="left" valign="top"><p>The file path. For relative files this is the starting directory + the
relative filename. For absolute files this is the absolute path.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileRelativePath</code></p></td><td align="left" valign="top"><p>The relative path.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileParent</code></p></td><td align="left" valign="top"><p>The parent path.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileLength</code></p></td><td align="left" valign="top"><p>A <code class="literal">long</code> value containing the file size.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelFileLastModified</code></p></td><td align="left" valign="top"><p>A <code class="literal">Long</code> value containing the last modified timestamp of the file. In
<span class="strong"><strong>Camel 2.10.3 and older</strong></span> the type is <code class="literal">Date</code>.</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_batch_consumer_5"></a>Batch Consumer</h2></div></div></div><p>This component implements the Batch Consumer.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_exchange_properties_file_consumer_only"></a>Exchange Properties, file consumer only</h2></div></div></div><p>As the file consumer implements the&nbsp;<code class="literal">BatchConsumer</code> it supports batching
the files it polls. By batching we mean that Camel will add the
following additional properties to the Exchange, so
you know the number of files polled, the current index, and whether the
batch is already completed.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="90%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Property</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelBatchSize</code></p></td><td align="left" valign="top"><p>The total number of files that was polled in this batch.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelBatchIndex</code></p></td><td align="left" valign="top"><p>The current index of the batch. Starts from 0.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelBatchComplete</code></p></td><td align="left" valign="top"><p>A <code class="literal">boolean</code> value indicating the last Exchange in
the batch. Is only <code class="literal">true</code> for the last entry.</p></td></tr></tbody></table></div><p>This allows you for instance to know how many files exist in this batch
and for instance let the Aggregator2 aggregate
this number of files.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_charset"></a>Using charset</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.9.3</strong></span>
 The charset option allows for configuring an encoding of the files on
both the consumer and producer endpoints. For example if you read utf-8
files, and want to convert the files to iso-8859-1, you can do:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:inbox?charset=utf-8"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:outbox?charset=iso-8859-1"</em></strong>)</pre><p>You can also use the <code class="literal">convertBodyTo</code> in the route. In the example below
we have still input files in utf-8 format, but we want to convert the
file content to a byte array in iso-8859-1 format. And then let a bean
process the data. Before writing the content to the outbox folder using
the current charset.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:inbox?charset=utf-8"</em></strong>)
  .convertBodyTo(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">byte</strong>[].<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"iso-8859-1"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:myBean"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:outbox"</em></strong>);</pre><p>If you omit the charset on the consumer endpoint, then Camel does not
know the charset of the file, and would by default use "UTF-8". However
you can configure a JVM system property to override and use a different
default encoding with the key <code class="literal">org.apache.camel.default.charset</code>.</p><p>In the example below this could be a problem if the files is not in
UTF-8 encoding, which would be the default encoding for read the
files.
 In this example when writing the files, the content has already been
converted to a byte array, and thus would write the content directly as
is (without any further encodings).</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:inbox"</em></strong>)
  .convertBodyTo(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">byte</strong>[].<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"iso-8859-1"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:myBean"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:outbox"</em></strong>);</pre><p>You can also override and control the encoding dynamic when writing
files, by setting a property on the exchange with the key
<code class="literal">Exchange.CHARSET_NAME</code>. For example in the route below we set the
property with a value from a message header.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:inbox"</em></strong>)
  .convertBodyTo(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">byte</strong>[].<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"iso-8859-1"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bean:myBean"</em></strong>)
  .setProperty(Exchange.CHARSET_NAME, header(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"someCharsetHeader"</em></strong>))
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:outbox"</em></strong>);</pre><p>We suggest to keep things simpler, so if you pickup files with the same
encoding, and want to write the files in a specific encoding, then favor
to use the <code class="literal">charset</code> option on the endpoints.</p><p>Notice that if you have explicit configured a <code class="literal">charset</code> option on the
endpoint, then that configuration is used, regardless of the
<code class="literal">Exchange.CHARSET_NAME</code> property.</p><p>If you have some issues then you can enable DEBUG logging on
<code class="literal">org.apache.camel.component.file</code>, and Camel logs when it reads/write a
file using a specific charset.
 For example the route below will log the following:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:inbox?charset=utf-8"</em></strong>)
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:outbox?charset=iso-8859-1"</em></strong>)</pre><p>And the logs:</p><pre class="screen">DEBUG GenericFileConverter           - Read file /Users/davsclaus/workspace/camel/camel-core/target/charset/input/input.txt with charset utf-8
DEBUG FileOperations                 - Using Reader to write file: target/charset/output.txt with charset: iso-8859-1</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_common_gotchas_with_folder_and_filenames"></a>Common gotchas with folder and filenames</h2></div></div></div><p>When Camel is producing files (writing files) there are a few gotchas
affecting how to set a filename of your choice. By default, Camel will
use the message ID as the filename, and since the message ID is normally
a unique generated ID, you will end up with filenames such as:
<code class="literal">ID-MACHINENAME-2443-1211718892437-1-0</code>. If such a filename is not
desired, then you must provide a filename in the <code class="literal">CamelFileName</code> message
header. The constant, <code class="literal">Exchange.FILE_NAME</code>, can also be used.</p><p>The sample code below produces files using the message ID as the
filename:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:report"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/reports"</em></strong>);</pre><p>To use <code class="literal">report.txt</code> as the filename you have to do:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:report"</em></strong>).setHeader(Exchange.FILE_NAME, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"report.txt"</em></strong>)).to( <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/reports"</em></strong>);</pre><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">the same as above, but with <code class="literal">CamelFileName</code>:</li></ol></div><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:report"</em></strong>).setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"CamelFileName"</em></strong>, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"report.txt"</em></strong>)).to( <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/reports"</em></strong>);</pre><p>And a syntax where we set the filename on the endpoint with the
<span class="strong"><strong>fileName</strong></span> URI option.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:report"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/reports/?fileName=report.txt"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_filename_expression"></a>Filename Expression</h2></div></div></div><p>Filename can be set either using the <span class="strong"><strong>expression</strong></span> option or as a
string-based <a class="link" href="file-language.html" title="File Language">File Language</a> expression in the
<code class="literal">CamelFileName</code> header. See the <a class="link" href="file-language.html" title="File Language">File Language</a>
for syntax and samples.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_consuming_files_from_folders_where_others_drop_files_directly"></a>Consuming files from folders where others drop files directly</h2></div></div></div><p>Beware if you consume files from a folder where other applications write
files to directly. Take a look at the different readLock options to see
what suits your use cases. The best approach is however to write to
another folder and after the write move the file in the drop folder.
However if you write files directly to the drop folder then the option
changed could better detect whether a file is currently being
written/copied as it uses a file changed algorithm to see whether the
file size / modification changes over a period of time. The other
readLock options rely on Java File API that sadly is not always very
good at detecting this. You may also want to look at the doneFileName
option, which uses a marker file (done file) to signal when a file is
done and ready to be consumed.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_done_files"></a>Using done files</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.6</strong></span></p><p>See also section <span class="emphasis"><em>writing done files</em></span> below.</p><p>If you want only to consume files when a done file exists, then you can
use the <code class="literal">doneFileName</code> option on the endpoint.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:bar?doneFileName=done"</em></strong>);</pre><p>Will only consume files from the bar folder, if a done <span class="emphasis"><em>file</em></span> exists in
the same directory as the target files. Camel will automatically delete
the <span class="emphasis"><em>done file</em></span> when it&#8217;s done consuming the files. From Camel <span class="strong"><strong>2.9.3</strong></span>
onwards Camel will not automatically delete the <span class="emphasis"><em>done file</em></span> if
<code class="literal">noop=true</code> is configured.</p><p>However it is more common to have one <span class="emphasis"><em>done file</em></span> per target file. This
means there is a 1:1 correlation. To do this you must use dynamic
placeholders in the <code class="literal">doneFileName</code> option. Currently Camel supports the
following two dynamic tokens: <code class="literal">file:name</code> and <code class="literal">file:name.noext</code> which
must be enclosed in $\{ }. The consumer only supports the static part of
the <span class="emphasis"><em>done file</em></span> name as either prefix or suffix (not both).</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:bar?doneFileName=${file:name}.done"</em></strong>);</pre><p>In this example only files will be polled if there exists a done file
with the name <span class="emphasis"><em>file name</em></span>.done. For example</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">hello.txt</code> - is the file to be consumed</li><li class="listitem"><code class="literal">hello.txt.done</code> - is the associated done file</li></ul></div><p>You can also use a prefix for the done file, such as:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:bar?doneFileName=ready-${file:name}"</em></strong>);</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">hello.txt</code> - is the file to be consumed</li><li class="listitem"><code class="literal">ready-hello.txt</code> - is the associated done file</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_writing_done_files"></a>Writing done files</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.6</strong></span></p><p>After you have written a file you may want to write an additional <span class="emphasis"><em>done</em></span>
<span class="emphasis"><em>file</em></span> as a kind of marker, to indicate to others that the file is
finished and has been written. To do that you can use the <code class="literal">doneFileName</code>
option on the file producer endpoint.</p><pre class="programlisting">.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:bar?doneFileName=done"</em></strong>);</pre><p>Will simply create a file named <code class="literal">done</code> in the same directory as the
target file.</p><p>However it is more common to have one done file per target file. This
means there is a 1:1 correlation. To do this you must use dynamic
placeholders in the <code class="literal">doneFileName</code> option. Currently Camel supports the
following two dynamic tokens: <code class="literal">file:name</code> and <code class="literal">file:name.noext</code> which
must be enclosed in $\{ }.</p><pre class="programlisting">.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:bar?doneFileName=done-${file:name}"</em></strong>);</pre><p>Will for example create a file named <code class="literal">done-foo.txt</code> if the target file
was <code class="literal">foo.txt</code> in the same directory as the target file.</p><pre class="programlisting">.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:bar?doneFileName=${file:name}.done"</em></strong>);</pre><p>Will for example create a file named <code class="literal">foo.txt.done</code> if the target file
was <code class="literal">foo.txt</code> in the same directory as the target file.</p><pre class="programlisting">.to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:bar?doneFileName=${file:name.noext}.done"</em></strong>);</pre><p>Will for example create a file named <code class="literal">foo.done</code> if the target file was
<code class="literal">foo.txt</code> in the same directory as the target file.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_samples_15"></a>Samples</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="file-component.html#_read_from_a_directory_and_write_to_another_directory_using_a_overrule_dynamic_name">Read from a directory and write to another directory using a overrule dynamic name</a></span></dt><dt><span class="section"><a href="file-component.html#_reading_recursively_from_a_directory_and_writing_to_another">Reading recursively from a directory and writing to another</a></span></dt></dl></div><p>#=== Read from a directory and write to another directory</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inputdir/?delete=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://outputdir"</em></strong>)</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_read_from_a_directory_and_write_to_another_directory_using_a_overrule_dynamic_name"></a>Read from a directory and write to another directory using a overrule dynamic name</h3></div></div></div><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inputdir/?delete=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://outputdir?overruleFile=copy-of-${file:name}"</em></strong>)</pre><p>Listen on a directory and create a message for each file dropped there.
Copy the contents to the <code class="literal">outputdir</code> and delete the file in the
<code class="literal">inputdir</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_reading_recursively_from_a_directory_and_writing_to_another"></a>Reading recursively from a directory and writing to another</h3></div></div></div><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inputdir/?recursive=true&amp;delete=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://outputdir"</em></strong>)</pre><p>Listen on a directory and create a message for each file dropped there.
Copy the contents to the <code class="literal">outputdir</code> and delete the file in the
<code class="literal">inputdir</code>. Will scan recursively into sub-directories. Will lay out the
files in the same directory structure in the <code class="literal">outputdir</code> as the
<code class="literal">inputdir</code>, including any sub-directories.</p><pre class="screen">inputdir/foo.txt
inputdir/sub/bar.txt</pre><p>Will result in the following output layout:</p><pre class="screen">outputdir/foo.txt
outputdir/sub/bar.txt</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="File2-Usingflatten"></a>Using flatten</h2></div></div></div><p>If you want to store the files in the outputdir directory in the same
directory, disregarding the source directory layout (e.g. to flatten out
the path), you just add the <code class="literal">flatten=true</code> option on the file producer
side:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inputdir/?recursive=true&amp;delete=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://outputdir?flatten=true"</em></strong>)</pre><p>Will result in the following output layout:</p><pre class="screen">outputdir/foo.txt
outputdir/bar.txt</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_reading_from_a_directory_and_the_default_move_operation"></a>Reading from a directory and the default move operation</h2></div></div></div><p>Camel will by default move any processed file into a <code class="literal">.camel</code>
subdirectory in the directory the file was consumed from.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inputdir/?recursive=true&amp;delete=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://outputdir"</em></strong>)</pre><p>Affects the layout as follows:
 <span class="strong"><strong>before</strong></span></p><pre class="screen">inputdir/foo.txt
inputdir/sub/bar.txt</pre><p><span class="strong"><strong>after</strong></span></p><pre class="screen">inputdir/.camel/foo.txt
inputdir/sub/.camel/bar.txt
outputdir/foo.txt
outputdir/sub/bar.txt</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_read_from_a_directory_and_process_the_message_in_java"></a>Read from a directory and process the message in java</h2></div></div></div><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inputdir/"</em></strong>).process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Processor() {
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> process(Exchange exchange) <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
    Object body = exchange.getIn().getBody();
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// do some business logic with the input body</em>
  }
});</pre><p>The body will be a <code class="literal">File</code> object that points to the file that was just
dropped into the <code class="literal">inputdir</code> directory.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_writing_to_files"></a>Writing to files</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="file-component.html#_write_to_subdirectory_using_literal_exchange_file_name_literal">Write to subdirectory using <code class="literal">Exchange.FILE_NAME</code></a></span></dt><dt><span class="section"><a href="file-component.html#_writing_file_through_the_temporary_directory_relative_to_the_final_destination">Writing file through the temporary directory relative to the final destination</a></span></dt></dl></div><p>Camel is of course also able to write files, i.e. produce files. In the
sample below we receive some reports on the SEDA queue that we process
before they are being written to a directory.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_write_to_subdirectory_using_literal_exchange_file_name_literal"></a>Write to subdirectory using <code class="literal">Exchange.FILE_NAME</code></h3></div></div></div><p>Using a single route, it is possible to write a file to any number of
subdirectories. If you have a route setup as such:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"bean:myBean"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file:/rootDirectory"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>You can have <code class="literal">myBean</code> set the header <code class="literal">Exchange.FILE_NAME</code> to values such
as:</p><pre class="screen">Exchange.FILE_NAME = hello.txt =&gt; /rootDirectory/hello.txt
Exchange.FILE_NAME = foo/bye.txt =&gt; /rootDirectory/foo/bye.txt</pre><p>This allows you to have a single route to write files to multiple
destinations.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_writing_file_through_the_temporary_directory_relative_to_the_final_destination"></a>Writing file through the temporary directory relative to the final destination</h3></div></div></div><p>Sometime you need to temporarily write the files to some directory
relative to the destination directory. Such situation usually happens
when some external process with limited filtering capabilities is
reading from the directory you are writing to. In the example below
files will be written to the&nbsp; <code class="literal">/var/myapp/filesInProgress</code> directory and
after data transfer is done, they will be atomically moved to
the`&nbsp;/var/myapp/finalDirectory `directory.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).
  to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:///var/myapp/finalDirectory?tempPrefix=/../filesInProgress/"</em></strong>);</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_expression_for_filenames"></a>Using expression for filenames</h2></div></div></div><p>In this sample we want to move consumed files to a backup folder using
today&#8217;s date as a sub-folder name:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inbox?move=backup/${date:now:yyyyMMdd}/${file:name}"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"..."</em></strong>);</pre><p>See <a class="link" href="file-language.html" title="File Language">File Language</a> for more samples.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_avoiding_reading_the_same_file_more_than_once_idempotent_consumer"></a>Avoiding reading the same file more than once (idempotent consumer)</h2></div></div></div><p>Camel supports Idempotent Consumer
directly within the component so it will skip already processed files.
This feature can be enabled by setting the <code class="literal">idempotent=true</code> option.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file://inbox?idempotent=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"..."</em></strong>);</pre><p>Camel uses the absolute file name as the idempotent key, to detect
duplicate files. From <span class="strong"><strong>Camel 2.11</strong></span> onwards you can customize this key by
using an expression in the idempotentKey option. For example to use both
the name and the file size as the key</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file://inbox?idempotent=true&amp;amp;idempotentKey=${file:name}-${file:size}"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"bean:processInbox"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>By default Camel uses a in memory based store for keeping track of
consumed files, it uses a least recently used cache holding up to 1000
entries. You can plugin your own implementation of this store by using
the <code class="literal">idempotentRepository</code> option using the <code class="literal">#</code> sign in the value to
indicate it&#8217;s a referring to a bean in the Registry
with the specified <code class="literal">id</code>.</p><pre class="programlisting"> <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- define our store as a plain spring bean --&gt;</em>
 <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myStore"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"com.mycompany.MyIdempotentStore"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file://inbox?idempotent=true&amp;amp;idempotentRepository=#myStore"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"bean:processInbox"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>Camel will log at <code class="literal">DEBUG</code> level if it skips a file because it has been
consumed before:</p><pre class="screen">DEBUG FileConsumer is idempotent and the file has been consumed before. Will skip this file: target\idempotent\report.txt</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_file_based_idempotent_repository"></a>Using a file based idempotent repository</h2></div></div></div><p>In this section we will use the file based idempotent repository
<code class="literal">org.apache.camel.processor.idempotent.FileIdempotentRepository</code> instead
of the in-memory based that is used as default.
 This repository uses a 1st level cache to avoid reading the file
repository. It will only use the file repository to store the content of
the 1st level cache. Thereby the repository can survive server restarts.
It will load the content of the file into the 1st level cache upon
startup. The file structure is very simple as it stores the key in
separate lines in the file. By default, the file store has a size limit
of 1mb. When the file grows larger Camel will truncate the file store,
rebuilding the content by flushing the 1st level cache into a fresh
empty file.</p><p>We configure our repository using Spring XML creating our file
idempotent repository and define our file consumer to use our repository
with the <code class="literal">idempotentRepository</code> using <code class="literal">#</code> sign to indicate
Registry lookup:</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_a_jpa_based_idempotent_repository"></a>Using a JPA based idempotent repository</h2></div></div></div><p>In this section we will use the JPA based idempotent repository instead
of the in-memory based that is used as default.</p><p>First we need a persistence-unit in <code class="literal">META-INF/persistence.xml</code> where we
need to use the class
<code class="literal">org.apache.camel.processor.idempotent.jpa.MessageProcessed</code> as model.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;persistence-unit</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"idempotentDb"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">transaction-type</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"RESOURCE_LOCAL"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;class&gt;</strong>org.apache.camel.processor.idempotent.jpa.MessageProcessed<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/class&gt;</strong>

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;properties&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"openjpa.ConnectionURL"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"jdbc:derby:target/idempotentTest;create=true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"openjpa.ConnectionDriverName"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.derby.jdbc.EmbeddedDriver"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"openjpa.jdbc.SynchronizeMappings"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"buildSchema"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"openjpa.Log"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"DefaultLevel=WARN, Tool=INFO"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"openjpa.Multithreaded"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/properties&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/persistence-unit&gt;</strong></pre><p>Next, we can create our JPA idempotent repository in the spring
XML file as well:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- we define our jpa based idempotent repository we want to use in the file consumer --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"jpaStore"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.processor.idempotent.jpa.JpaMessageIdRepository"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- Here we refer to the entityManagerFactory --&gt;</em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">index</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"0"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"entityManagerFactory"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- This 2nd parameter is the name  (= a category name).
         You can have different repositories with different names --&gt;</em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">index</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"1"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"FileConsumer"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre><p>And yes then we just need to refer to the <span class="strong"><strong>jpaStore</strong></span> bean in the file
consumer endpoint using the <code class="literal">idempotentRepository</code> using the <code class="literal">#</code> syntax
option:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file://inbox?idempotent=true&amp;amp;idempotentRepository=#jpaStore"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"bean:processInbox"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_filter_using_org_apache_camel_component_file_genericfilefilter"></a>Filter using org.apache.camel.component.file.GenericFileFilter</h2></div></div></div><p>Camel supports pluggable filtering strategies. You can then configure
the endpoint with such a filter to skip certain files being processed.</p><p>In the sample we have built our own filter that skips files starting
with <code class="literal">skip</code> in the filename:</p><p>And then we can configure our route using the <span class="strong"><strong>filter</strong></span> attribute to
reference our filter (using <code class="literal">#</code> notation) that we have defined in the
spring XML file:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- define our filter as a plain spring bean --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myFilter"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"com.mycompany.MyFileFilter"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file://inbox?filter=#myFilter"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"bean:processInbox"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_filtering_using_ant_path_matcher"></a>Filtering using ANT path matcher</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="file-component.html#_sorting_using_comparator">Sorting using Comparator</a></span></dt><dt><span class="section"><a href="file-component.html#_sorting_using_sortby">Sorting using sortBy</a></span></dt></dl></div><p>The ANT path matcher is shipped out-of-the-box in the <span class="strong"><strong>camel-spring</strong></span>
jar. So you need to depend on <span class="strong"><strong>camel-spring</strong></span> if you are using Maven.
 The reasons is that we leverage Spring&#8217;s
<a class="link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/util/AntPathMatcher.html" target="_top">AntPathMatcher</a>
to do the actual matching.</p><p>The file paths is matched with the following rules:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">?</code> matches one character</li><li class="listitem"><code class="literal">*</code> matches zero or more characters</li><li class="listitem"><code class="literal">**</code> matches zero or more directories in a path</li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>New options from Camel 2.10 onwards</strong></span>
There are now <code class="literal">antInclude</code> and <code class="literal">antExclude</code> options to make it easy to
specify ANT style include/exclude without having to define the filter.
See the URI options above for more information.</p></td></tr></table></div><p>The sample below demonstrates how to use it:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_sorting_using_comparator"></a>Sorting using Comparator</h3></div></div></div><p>Camel supports pluggable sorting strategies. This strategy it to use the
build in <code class="literal">java.util.Comparator</code> in Java. You can then configure the
endpoint with such a comparator and have Camel sort the files before
being processed.</p><p>In the sample we have built our own comparator that just sorts by file
name:</p><p>And then we can configure our route using the <span class="strong"><strong>sorter</strong></span> option to
reference to our sorter (<code class="literal">mySorter</code>) we have defined in the spring XML
file:</p><pre class="programlisting"> <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- define our sorter as a plain spring bean --&gt;</em>
 <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mySorter"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"com.mycompany.MyFileSorter"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file://inbox?sorter=#mySorter"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"bean:processInbox"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>URI options can reference beans using the # syntax</strong></span>
In the Spring DSL route above notice that we can refer to beans in the
Registry by prefixing the id with <code class="literal">#</code>. So writing
<code class="literal">sorter=#mySorter</code>, will instruct Camel to go look in the
Registry for a bean with the ID, <code class="literal">mySorter</code>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_sorting_using_sortby"></a>Sorting using sortBy</h3></div></div></div><p>Camel supports pluggable sorting strategies. This strategy it to use the
<a class="link" href="file-language.html" title="File Language">File Language</a> to configure the sorting. The
<code class="literal">sortBy</code> option is configured as follows:</p><pre class="screen">sortBy=group 1;group 2;group 3;...</pre><p>Where each group is separated with semi colon. In the simple situations
you just use one group, so a simple example could be:</p><pre class="screen">sortBy=file:name</pre><p>This will sort by file name, you can reverse the order by prefixing
<code class="literal">reverse:</code> to the group, so the sorting is now Z..A:</p><pre class="screen">sortBy=reverse:file:name</pre><p>As we have the full power of <a class="link" href="file-language.html" title="File Language">File Language</a> we
can use some of the other parameters, so if we want to sort by file size
we do:</p><pre class="screen">sortBy=file:length</pre><p>You can configure to ignore the case, using <code class="literal">ignoreCase:</code> for string
comparison, so if you want to use file name sorting but to ignore the
case then we do:</p><pre class="screen">sortBy=ignoreCase:file:name</pre><p>You can combine ignore case and reverse, however reverse must be
specified first:</p><pre class="screen">sortBy=reverse:ignoreCase:file:name</pre><p>In the sample below we want to sort by last modified file, so we do:</p><pre class="screen">sortBy=file:modified</pre><p>And then we want to group by name as a 2nd option so files with same
modifcation is sorted by name:</p><pre class="screen">sortBy=file:modified;file:name</pre><p>Now there is an issue here, can you spot it? Well the modified timestamp
of the file is too fine as it will be in milliseconds, but what if we
want to sort by date only and then subgroup by name?
 Well as we have the true power of <a class="link" href="file-language.html" title="File Language">File Language</a> we can use&nbsp;its date command that supports patterns. So this
can be solved as:</p><pre class="screen">sortBy=date:file:yyyyMMdd;file:name</pre><p>Yeah, that is pretty powerful, oh by the way you can also use reverse
per group, so we could reverse the file names:</p><pre class="screen">sortBy=date:file:yyyyMMdd;reverse:file:name</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_genericfileprocessstrategy"></a>Using GenericFileProcessStrategy</h2></div></div></div><p>The option <code class="literal">processStrategy</code> can be used to use a custom
<code class="literal">GenericFileProcessStrategy</code> that allows you to implement your own
<span class="emphasis"><em>begin</em></span>, <span class="emphasis"><em>commit</em></span> and <span class="emphasis"><em>rollback</em></span> logic.
 For instance lets assume a system writes a file in a folder you should
consume. But you should not start consuming the file before another
<span class="emphasis"><em>ready</em></span> file has been written as well.</p><p>So by implementing our own <code class="literal">GenericFileProcessStrategy</code> we can implement
this as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">In the <code class="literal">begin()</code> method we can test whether the special <span class="emphasis"><em>ready</em></span> file
exists. The begin method returns a <code class="literal">boolean</code> to indicate if we can
consume the file or not.</li><li class="listitem">In the <code class="literal">abort()</code> method (Camel 2.10) special logic can be executed in
case the <code class="literal">begin</code> operation returned <code class="literal">false</code>, for example to cleanup
resources etc.</li><li class="listitem">in the <code class="literal">commit()</code> method we can move the actual file and also delete
the <span class="emphasis"><em>ready</em></span> file.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_filter"></a>Using filter</h2></div></div></div><p>The <code class="literal">filter</code> option allows you to implement a custom filter in Java code
by implementing the <code class="literal">org.apache.camel.component.file.GenericFileFilter</code>
interface. This interface has an <code class="literal">accept</code> method that returns a boolean.
Return <code class="literal">true</code> to include the file, and <code class="literal">false</code> to skip the file. From
Camel 2.10 onwards, there is a <code class="literal">isDirectory</code> method on <code class="literal">GenericFile</code>
whether the file is a directory. This allows you to filter unwanted
directories, to avoid traversing down unwanted directories.</p><p>For example to skip any directories which starts with <code class="literal">"skip"</code> in the
name, can be implemented as follows:</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_consumer_bridgeerrorhandler"></a>Using consumer.bridgeErrorHandler</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.10</strong></span></p><p>If you want to use the Camel Error Handler to
deal with any exception occurring in the file consumer, then you can
enable the <code class="literal">consumer.bridgeErrorHandler</code> option as shown below:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// to handle any IOException being thrown</em>
onException(IOException.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)
    .handled(true)
    .log(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"IOException occurred due: ${exception.message}"</em></strong>)
    .transform().simple(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Error ${exception.message}"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:error"</em></strong>);

<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// this is the file route that pickup files, notice how we bridge the consumer to use the Camel routing error handler</em>
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// the exclusiveReadLockStrategy is only configured because this is from an unit test, so we use that to simulate exceptions</em>
from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/nospace?consumer.bridgeErrorHandler=true"</em></strong>)
    .convertBodyTo(String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre><p>So all you have to do is to enable this option, and the error handler in
the route will take it from there.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Important when using consumer.bridgeErrorHandler</strong></span>
When using consumer.bridgeErrorHandler, then
interceptors, OnCompletions
does <span class="strong"><strong>not</strong></span> apply. The Exchange is processed directly
by the Camel Error Handler, and does not allow
prior actions such as interceptors, onCompletion to take action.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_debug_logging"></a>Debug logging</h2></div></div></div><p>This component has log level <span class="strong"><strong>TRACE</strong></span> that can be helpful if you have
problems.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_45"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="file-language.html" title="File Language">File Language</a></li><li class="listitem">FTP</li><li class="listitem">Polling Consumer</li></ul></div></div></div></body></html>